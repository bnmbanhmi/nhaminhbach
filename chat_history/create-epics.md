
   ░░░            ░░░░░░░░░  ░░░░░░░░░░ ░░░░░░   ░░░░░░ ░░░░░ ░░░░░░   ░░░░░ ░░░░░
     ░░░         ░░░     ░░░ ░░░        ░░░░░░   ░░░░░░  ░░░  ░░░░░░   ░░░░░  ░░░
       ░░░      ░░░          ░░░        ░░░ ░░░ ░░░ ░░░  ░░░  ░░░ ░░░  ░░░    ░░░
 ███     ░░░    █████████░░██████████ ██████ ░░██████░█████░██████ ░░█████ █████░
   ███ ░░░     ███░    ███░███░░      ██████  ░██████░░███░░██████  ░█████  ███░░
     ███      ███░░░     ░░███░░      ███░███ ███ ███░░███░░███░███  ███░░  ███░░
   ░░░ ███    ███ ░░░█████░██████░░░░░███░░█████  ███░░███░░███░░███ ███░░░ ███░░░
     ███      ███      ███ ███        ███   ███   ███  ███  ███   ██████    ███
   ███         ███     ███ ███        ███         ███  ███  ███    █████    ███
 ███            █████████  ██████████ ███         ███ █████ ███     █████  █████

Tips for getting started:
1. Ask questions, edit files, or run commands.
2. Be specific for the best results.
3. /help for more information.

ℹ You have 1 extension with an update available. Run "/extensions update context7".

> /bmad-workflow-bmm-create-epics-and-stories

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFolder _bmad/bmm/workflows                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
│ Listed 10 item(s).                                                                                                                                                                                                                                                                      │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFolder _bmad/bmm/workflows/3-solutioning                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                         │
│ Listed 3 item(s).                                                                                                                                                                                                                                                                       │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFolder _bmad/.../create-epics-and-stories                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                         │
│ Listed 3 item(s).                                                                                                                                                                                                                                                                       │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFile _bmad/.../workflow.md                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFile _bmad/bmm/config.yaml                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFile step-01-validate-prerequisites.md                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFolder _bmad-output/planning-artifacts                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                         │
│ Listed 3 item(s).                                                                                                                                                                                                                                                                       │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFile _bmad/.../epics-template.md                                                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ Welcome Minh to comprehensive epic and story creation!

  I have identified the following prerequisite documents for our workflow:
   - prd.md (Product Requirements Document)
   - architecture.md (Architecture Decisions)
   - ux-design-specification.md (UX Design)

  Are there any other documents I should consider, or is this all there is? [Yes/No]

> yes

✦ Please list the additional documents you would like me to consider, or clarify if you meant that the ones I found are sufficient.

> no, that's all. continue

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFile _bmad-output/.../prd.md                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                         │
│ ✓  ReadFile _bmad-output/.../architecture.md                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                         │
│ ✓  ReadFile _.../.../ux-design-specification.md                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  WriteFile Writing to _bmad-output/.../epics.md                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
│  1 ---                                                                                                                                                                                                                                                                                  │
│  2 stepsCompleted: [1]                                                                                                                                                                                                                                                                  │
│  3 inputDocuments:                                                                                                                                                                                                                                                                      │
│  4   - _bmad-output/planning-artifacts/prd.md                                                                                                                                                                                                                                           │
│  5   - _bmad-output/planning-artifacts/architecture.md                                                                                                                                                                                                                                  │
│  6   - _bmad-output/planning-artifacts/ux-design-specification.md                                                                                                                                                                                                                       │
│  7 ---                                                                                                                                                                                                                                                                                  │
│  8                                                                                                                                                                                                                                                                                      │
│  9 # nhaminhbach - Epic Breakdown                                                                                                                                                                                                                                                       │
│ 10                                                                                                                                                                                                                                                                                      │
│ 11 ## Overview                                                                                                                                                                                                                                                                          │
│ 12                                                                                                                                                                                                                                                                                      │
│ 13 This document provides the complete epic and story breakdown for nhaminhbach, decomposing the requirements from the PRD, UX Design if it exists, and Architecture requirements into implementable stories.                                                                           │
│ 14                                                                                                                                                                                                                                                                                      │
│ 15 ## Requirements Inventory                                                                                                                                                                                                                                                            │
│ 16                                                                                                                                                                                                                                                                                      │
│ 17 ### Functional Requirements                                                                                                                                                                                                                                                          │
│ 18                                                                                                                                                                                                                                                                                      │
│ 19 FR1: Seekers can navigate directly to a specific property using a unique GeoID.                                                                                                                                                                                                      │
│ 20 FR2: Seekers can build logical queries using a guided token-based interface (chips).                                                                                                                                                                                                 │
│ 21 FR3: Seekers can perform standard keyword searches across property descriptions.                                                                                                                                                                                                     │
│ 22 FR4: Seekers can filter property results by Price Range, Ward, and District.                                                                                                                                                                                                         │
│ 23 FR5: Seekers can view a map representation of property locations (pin or circle based on accuracy).                                                                                                                                                                                  │
│ 24 FR6: Seekers can toggle between a "Guided Query" mode and standard keyword search.                                                                                                                                                                                                   │
│ 25 FR7: Seekers can view a historical price timeline for a specific room (The "Time Machine").                                                                                                                                                                                          │
│ 26 FR8: Seekers can view "Góc nhìn thật" (Real view) and "Điểm trừ" (Cons) metadata for any listing.                                                                                                                                                                                    │
│ 27 FR9: Seekers can initiate a direct Zalo chat with the Platform Admin (Minh) regarding a specific property.                                                                                                                                                                           │
│ 28 FR10: Landlords can share their specific property or portfolio via a human-readable alias URL.                                                                                                                                                                                       │
│ 29 FR11: Users can view property contact information only after passing a "Login Wall" or verification gate.                                                                                                                                                                            │
│ 30 FR12: Users can trigger a pre-filled Zalo message template containing the property's GeoID.                                                                                                                                                                                          │
│ 31 FR13: The System can autonomously ingest raw rental posts from social media sources.                                                                                                                                                                                                 │
│ 32 FR14: The System can transform unstructured Vietnamese text into structured property data.                                                                                                                                                                                           │
│ 33 FR15: The System can identify unique physical properties across multiple social posts using address/phone fingerprinting.                                                                                                                                                            │
│ 34 FR16: The System can automatically generate unique, hierarchical GeoIDs for new properties.                                                                                                                                                                                          │
│ 35 FR17: The System can geocode structured addresses into geographic coordinates using a fallback sequence.                                                                                                                                                                             │
│ 36 FR18: The System can rewrite social media descriptions into unique platform content using AI.                                                                                                                                                                                        │
│ 37 FR19: Admins can review ingested data in a side-by-side comparison interface (Raw vs. Refined).                                                                                                                                                                                      │
│ 38 FR20: Admins can manually override and edit any attribute of a listing before approval.                                                                                                                                                                                              │
│ 39 FR21: Admins can approve or reject pending listings with a single action.                                                                                                                                                                                                            │
│ 40 FR22: Admins can view fingerprint collision alerts for properties that have appeared historically.                                                                                                                                                                                   │
│ 41 FR23: Admins can manage the "Available/Rented" status of any room in the system.                                                                                                                                                                                                     │
│ 42 FR24: The System can identify and auto-ban non-human scraping agents via invisible "Honeypot" links.                                                                                                                                                                                 │
│ 43 FR25: The System can rate-limit the viewing of sensitive contact information per user.                                                                                                                                                                                               │
│ 44 FR26: The System can enforce a "Login Wall" for accessing owner/admin contact details.                                                                                                                                                                                               │
│ 45                                                                                                                                                                                                                                                                                      │
│ 46 ### NonFunctional Requirements                                                                                                                                                                                                                                                       │
│ 47                                                                                                                                                                                                                                                                                      │
│ 48 NFR1: Short ID Resolution: Entering a GeoID in the search bar must resolve to the property page in < 300ms (network excluding).                                                                                                                                                      │
│ 49 NFR2: Search Intent Latency: Transforming natural language to a logical query and returning results must complete in < 800ms.                                                                                                                                                        │
│ 50 NFR3: First Contentful Paint (FCP): The public landing page must load in < 1.5s on a standard 4G connection in Hanoi.                                                                                                                                                                │
│ 51 NFR4: Mobile Smoothness: Touch interactions (scrolling, chip selection) must maintain 60fps to ensure a "Zalo-like" responsive feel.                                                                                                                                                 │
│ 52 NFR5: Data Protection (Smart Gating): Owner contact information must be protected behind a rate-limiting gate (e.g., maximum 5 contact views per day per user).                                                                                                                      │
│ 53 NFR6: Competitor Defense: Implement Honeypot link detection that automatically blacklists IPs demonstrating bulk-scraping behavior within < 10 seconds of detection.                                                                                                                 │
│ 54 NFR7: Data Integrity: All LLM-generated data must pass Pydantic schema validation before being committed to Supabase to prevent data corruption.                                                                                                                                     │
│ 55 NFR8: Admin Security: Minh's access to the QC Cockpit must be secured via Multi-Factor Authentication (MFA) or Zalo Social Login.                                                                                                                                                    │
│ 56 NFR9: Horizontal Scraping: The GCP pipeline must support scaling to 50+ concurrent Cloud Run instances to handle regional expansion without architectural changes.                                                                                                                   │
│ 57 NFR10: Storage Strategy: Supabase storage must handle up to 100,000 active listings with price history without query performance degradation (using proper indexing on full_geo_id and address_hash).                                                                                │
│ 58 NFR11: Refinery Throughput: The transformation engine must be capable of processing 1,000+ social media posts daily without human intervention bottlenecking the pipeline.                                                                                                           │
│ 59 NFR12: SLA Freshness: Data ingested from social media must be processed and ready for verification in < 24 hours.                                                                                                                                                                    │
│ 60 NFR13: Transactional Consistency: 100% of listing creations must be Atomic (House + Room + History) to prevent partial data states.                                                                                                                                                  │
│ 61                                                                                                                                                                                                                                                                                      │
│ 62 ### Additional Requirements                                                                                                                                                                                                                                                          │
│ 63                                                                                                                                                                                                                                                                                      │
│ 64 **From Architecture:**                                                                                                                                                                                                                                                               │
│ 65 - **Starter Template:** Use the Custom Turborepo Construction with `pnpm` workspaces for React (Vite), FastAPI, and Docker (Scraper).                                                                                                                                                │
│ 66 - **Data Modeling:** Use JSONB for property attributes in PostgreSQL, validated by Pydantic v2.                                                                                                                                                                                      │
│ 67 - **Migrations:** Use Alembic (v1.18.2) for schema evolution.                                                                                                                                                                                                                        │
│ 68 - **Identity & Auth:** Use Supabase Auth for user-facing services and Shared API Secret (`X-NHB-SECRET`) for Scraper-to-API communication.                                                                                                                                           │
│ 69 - **Frontend State:** Use TanStack Query (v5.x) for server state and Zustand (v5.x) for client state (Search Bar).                                                                                                                                                                   │
│ 70 - **Deployment:** Docker-First for Scraper, Vercel for App Tier.                                                                                                                                                                                                                     │
│ 71 - **Naming Conventions:** Strict adherence to defined naming (camelCase JSON, snake_case DB/Python) and structure patterns.                                                                                                                                                          │
│ 72 - **Error Handling:** Standardized Error Objects for API responses.                                                                                                                                                                                                                  │
│ 73                                                                                                                                                                                                                                                                                      │
│ 74 **From UX Design:**                                                                                                                                                                                                                                                                  │
│ 75 - **Responsive Design:** Mobile-First SPA optimized for 360px-420px viewports.                                                                                                                                                                                                       │
│ 76 - **Interaction:** "Smart Waterfall Search Bar" logic (GeoID -> Chips -> Keyword).                                                                                                                                                                                                   │
│ 77 - **Touch Targets:** Minimum 44px hit area for all interactive elements.                                                                                                                                                                                                             │
│ 78 - **Aesthetic:** "Future Warmth" palette (Coral/Cream) and "Her" aesthetic (soft rounded corners).                                                                                                                                                                                   │
│ 79 - **Component Strategy:** Use Headless UI wrapped in Tailwind CSS.                                                                                                                                                                                                                   │
│ 80 - **Navigation:** Bottom Sheets for detail views on mobile; Gestures for closing.                                                                                                                                                                                                    │
│ 81 - **Accessibility:** Keyboard sovereignty for Search Bar; WCAG 2.1 AA contrast compliance.                                                                                                                                                                                           │
│ 82                                                                                                                                                                                                                                                                                      │
│ 83 ### FR Coverage Map                                                                                                                                                                                                                                                                  │
│ 84                                                                                                                                                                                                                                                                                      │
│ 85 {{requirements_coverage_map}}                                                                                                                                                                                                                                                        │
│ 86                                                                                                                                                                                                                                                                                      │
│ 87 ## Epic List                                                                                                                                                                                                                                                                         │
│ 88                                                                                                                                                                                                                                                                                      │
│ 89 {{epics_list}}                                                                                                                                                                                                                                                                       │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ I have successfully extracted and compiled the requirements into _bmad-output/planning-artifacts/epics.md.

  Functional Requirements Extracted:
   - Found 26 Functional Requirements (FR1 - FR26), covering Property Discovery, Interaction, Data Factory/Refinery, Quality Control, and Security.

  Non-Functional Requirements Extracted:
   - Found 13 Non-Functional Requirements (NFR1 - NFR13), covering Performance, Security, Scalability, and Reliability.

  Additional Requirements:
   - Architecture: Includes Turborepo setup, JSONB data strategy, Supabase Auth/Shared Secret security, TanStack/Zustand state management, and strict naming conventions.
   - UX Design: Includes "Smart Waterfall Search" logic, Mobile-First "Her" aesthetic, and specific accessibility standards.

  Confirm the Requirements are complete and correct to [C] continue:
   - [C] Continue
   - [Chat] or ask questions

> one more feature is missing. maybe across all planning files, that is, allow admin to manually input listings (individually or in bulk). use the same interface as FR20 the manual feature editing. and add this across all relateed planning files, not just epics.md

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  Edit _bmad-output/.../prd.md: - **FR23:** Admins can manage ... => - **FR23:** Admins can manage ...                                                                                                                                                                                 │
│                                                                                                                                                                                                                                                                                         │
│ 345   - **FR21:** Admins can approve or reject pending listings with a single action.                                                                                                                                                                                                   │
│ 346   - **FR22:** Admins can view fingerprint collision alerts for properties that have appeared historically.                                                                                                                                                                          │
│ 347   - **FR23:** Admins can manage the "Available/Rented" status of any room in the system.                                                                                                                                                                                            │
│ 348 + - **FR27:** Admins can manually input new listings (individually or in bulk) via the admin interface, reusing the manual edit components.                                                                                                                                         │
│ 349                                                                                                                                                                                                                                                                                     │
│ 350   ### Security & Integrity                                                                                                                                                                                                                                                          │
│ 351   - **FR24:** The System can identify and auto-ban non-human scraping agents via invisible "Honeypot" links.                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                         │
│ x  Edit {"new_string":"- `PATCH /api/v1/qc/verify/{id}`: Minh’s one-click approval endpoint in the Cockpit.\n- `POST /api/v1/listings/manual`: Endpoint for admin manual creation of listings.","old_string":"- `PATCH /api/v1/qc/verify/{id}`: Minh’s one-click approval endpoint in … │
│                                                                                                                                                                                                                                                                                         │
│ Failed to edit, 0 occurrences found for old_string (- `PATCH /api/v1/qc/verify/{id}`: Minh’s one-click approval endpoint in the Cockpit.). Original old_string was (- `PATCH /api/v1/qc/verify/{id}`: Minh’s one-click approval endpoint in the Cockpit.) in                            │
│ /Users/mac/nhaminhbach.com/nhaminhbach/_bmad-output/planning-artifacts/architecture.md. No edits made. The exact text in old_string was not found. Ensure you're not escaping content incorrectly and check whitespace, indentation, and context. Use read_file tool to verify.         │
│                                                                                                                                                                                                                                                                                         │
│ ✓  Edit _.../.../ux-design-specification.md: ### Journey 3: The "Verifier" ... => ### Journey 3: The "Verifier" ...                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ 255       H --> D                                                                                                                                                                                                                                                                       │
│ 256   ```                                                                                                                                                                                                                                                                               │
│ 257                                                                                                                                                                                                                                                                                     │
│ 258 - ### Journey 3: The "Verifier" (Admin QC)                                                                                                                                                                                                                                          │
│ 259 - **Goal:** The admin rapidly validates incoming scraped data against the source truth.                                                                                                                                                                                             │
│ 258 + ### Journey 3: The "Verifier" (Admin QC) & Manual Entry                                                                                                                                                                                                                           │
│ 259 + **Goal:** The admin rapidly validates incoming scraped data or manually inputs new listings using the unified interface.                                                                                                                                                          │
│ 260                                                                                                                                                                                                                                                                                     │
│ 261   ```mermaid                                                                                                                                                                                                                                                                        │
│ 262   graph LR                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                         │
│ ✓  Edit _bmad-output/.../epics.md: FR23: Admins can manage the "A... => FR23: Admins can manage the "A...                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                         │
│ 39   FR21: Admins can approve or reject pending listings with a single action.                                                                                                                                                                                                          │
│ 40   FR22: Admins can view fingerprint collision alerts for properties that have appeared historically.                                                                                                                                                                                 │
│ 41   FR23: Admins can manage the "Available/Rented" status of any room in the system.                                                                                                                                                                                                   │
│ 42 + FR27: Admins can manually input new listings (individually or in bulk) via the admin interface, reusing the manual edit components.                                                                                                                                                │
│ 43   FR24: The System can identify and auto-ban non-human scraping agents via invisible "Honeypot" links.                                                                                                                                                                               │
│ 44   FR25: The System can rate-limit the viewing of sensitive contact information per user.                                                                                                                                                                                             │
│ 45   FR26: The System can enforce a "Login Wall" for accessing owner/admin contact details.                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  SearchText 'PATCH /api/v1/qc/verify' in architecture.md within _bmad-output/planning-artifacts                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
│ No matches found                                                                                                                                                                                                                                                                        │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  SearchText 'qc/verify' in architecture.md within _bmad-output/planning-artifacts                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ No matches found                                                                                                                                                                                                                                                                        │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFile _bmad-output/.../architecture.md                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  Edit _bmad-output/.../prd.md: - `PATCH /api/v1/qc/verify/{id... => - `PATCH /api/v1/qc/verify/{id...                                                                                                                                                                                 │
│                                                                                                                                                                                                                                                                                         │
│ 266   - `GET /api/v1/listings`: Filterable feed with support for GeoID metadata.                                                                                                                                                                                                        │
│ 267   - `POST /api/v1/ingest`: Secured endpoint for the GCP Refinery to deliver "Clean Oil."                                                                                                                                                                                            │
│ 268   - `PATCH /api/v1/qc/verify/{id}`: Minh’s one-click approval endpoint in the Cockpit.                                                                                                                                                                                              │
│ 269 + - `POST /api/v1/listings/manual`: Endpoint for admin manual creation of listings.                                                                                                                                                                                                 │
│ 270   - `GET /api/v1/houses/{id}/history`: Powers the "Time Machine" price chart.                                                                                                                                                                                                       │
│ 271                                                                                                                                                                                                                                                                                     │
│ 272   ## Project Scoping & Phased Development                                                                                                                                                                                                                                           │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ I have updated the planning files to include the new feature: Admin Manual Listing Input.

  Updates made:
   1. PRD (`prd.md`):
       - Added FR27: Admins can manually input new listings... to Functional Requirements.
       - Added POST /api/v1/listings/manual to Endpoint Specifications.
   2. UX Design (`ux-design-specification.md`):
       - Updated "Journey 3" to explicitly include "Manual Entry" as a goal for the Admin/Verifier.
   3. Epics (`epics.md`):
       - Added FR27 to the extracted Functional Requirements list.

  The Architecture document focuses on high-level decisions and already covers the QC Cockpit feature area and FastAPI structure, which supports this new endpoint without requiring structural changes.

  Confirm the Requirements are complete and correct to [C] continue:
   - [C] Continue
   - [Chat] or ask questions

> continue

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ x  Edit {"new_string":"---\nstepsCompleted: [1]\ninputDocuments:","expected_replacements":1,"old_string":"---\nstepsCompleted: [1]\ninputDocuments:","instruction":"Update stepsCompleted to indicate Step 1 is finished.","file_path":"/Users/mac/nhaminhbach.com/nhaminhbach/_bmad-o… │
│                                                                                                                                                                                                                                                                                         │
│ A secondary check by an LLM determined that no changes were necessary to fulfill the instruction. Explanation: The original search failed because the `replace` string was identical to the `search` string, and the content to be changed (`stepsCompleted: [1]`) already matched the  │
│ desired state in the file. No changes are required as the file already reflects the instruction.. Original error with the parameters given: No changes to apply. The old_string and new_string are identical in file:                                                                   │
│ /Users/mac/nhaminhbach.com/nhaminhbach/_bmad-output/planning-artifacts/epics.md                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                         │
│ ✓  ReadFile _bmad/.../step-02-design-epics.md                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ Now we will design the Epic List to organize the requirements into user-value-focused increments.

  Proposed Epic Structure

  Epic 1: Project Foundation & Admin Core (The "Refinery" & "Cockpit")
   * Goal: Establish the hybrid cloud infrastructure, automated scraping pipeline, and the side-by-side QC interface. This enables the platform to begin generating the "Clean Source of Truth."
   * FRs covered: FR13, FR14, FR15, FR16, FR17, FR18, FR19, FR20, FR21, FR22, FR23, FR27.
   * User Value: Minh (Admin) can ingest social media chaos, refine it into GeoIDs, and manually manage listings with a professional verification workflow.

  Epic 2: Core Seeker Experience (Discovery & Navigation)
   * Goal: Implement the public-facing listing grid, detail pages, and the "Instant Teleport" GeoID navigation.
   * FRs covered: FR1, FR3, FR4, FR5, FR8, FR10.
   * User Value: Hương (Seeker) can find properties, see "Real View/Cons" metadata, and jump directly to listings using short IDs.

  Epic 3: Smart Interaction & Trust (Guided Search & Gating)
   * Goal: Build the advanced "Guided Query Builder" in the search bar and implement secure contact flows via Zalo deep-linking and rate-limiting.
   * FRs covered: FR2, FR6, FR9, FR11, FR12, FR24, FR25, FR26.
   * User Value: Hương can build complex queries with UI chips and initiate high-trust contact while the system protects owner data from bots.

  Epic 4: The Time Machine (History & Transparency)
   * Goal: Implement SCD Type 2 tracking to visualize historical price trends for properties.
   * FRs covered: FR7.
   * User Value: Hương builds trust through transparency by seeing how property prices have evolved over time.

  ---

  FR Coverage Map
   - Epic 1: FR13-FR23, FR27 (Refinery & QC)
   - Epic 2: FR1, FR3, FR4, FR5, FR8, FR10 (Basic Discovery)
   - Epic 3: FR2, FR6, FR9, FR11, FR12, FR24, FR25, FR26 (Advanced Search & Interaction)
   - Epic 4: FR7 (Historical Data)

  Do you approve this epic structure for proceeding to story creation?

  Select an Option: [A] Advanced Elicitation [P] Party Mode [C] Continue

> i think it should be like this: focus on a basic interface, where user can manually add listing, and seeker can view listing, first. basically a first mvp, where things can be as manual as possible. also, the cloud infrastructure and scraping and data pipeline, etc should be a
  seperate epic. just start with the simple listing web page allow viewing and manually adding listing.

✦ Based on your feedback, here is the revised Epic structure focusing on a "Manual First" MVP approach:

  Revised Epic Structure

  Epic 1: The Manual MVP (Core Listing & Viewing)
   * Goal: Build the essential "manual" platform where Admins can create listings by hand and Seekers can discover and view them. This validates the core data model and user experience without complex automation.
   * FRs covered:
       * Admin: FR27 (Manual Input), FR20 (Edit Listing), FR23 (Status Management).
       * Seeker: FR3 (Keyword Search), FR4 (Basic Filtering), FR8 (View Metadata: Real View/Cons), FR10 (Shareable Links).
       * System: FR16 (GeoID Generation - Simple Logic), FR17 (Geocoding - Basic).
   * User Value: Minh can manually build a high-quality portfolio; Hương can view and filter these verified listings immediately.

  Epic 2: The "Smart" Search & Interaction
   * Goal: Enhance the seeker experience with the innovative "Smart Waterfall Search" (GeoID jumps, Guided Chips) and secure contact flows.
   * FRs covered: FR1 (GeoID Navigation), FR2 (Guided Chips), FR6 (Toggle Mode), FR5 (Map View), FR9 (Zalo Chat), FR11/25/26 (Smart Gating/Login Wall), FR12 (Zalo Templates).
   * User Value: Drastically improves discovery speed and secures the connection between Seeker and Admin.

  Epic 3: Automated Data Refinery (GCP Pipeline)
   * Goal: Introduce the high-throughput automation layer to ingest and transform social media data, replacing manual entry.
   * FRs covered: FR13 (Ingestion), FR14 (Transformation), FR15 (Fingerprinting), FR18 (AI Rewriting), FR19 (QC Side-by-Side), FR21 (Approve/Reject), FR22 (Collision Alerts), FR24 (Bot Defense).
   * User Value: Scales the platform from "Manual Boutique" to "Industrial Refinery," allowing Minh to process 1000+ listings daily.

  Epic 4: The Time Machine (History)
   * Goal: Activate historical tracking for price transparency.
   * FRs covered: FR7 (Price Timeline).
   * User Value: Adds long-term trust and market intelligence.

  ---

  Revised FR Coverage Map
   - Epic 1: FR3, FR4, FR8, FR10, FR16, FR17, FR20, FR23, FR27 (Manual MVP)
   - Epic 2: FR1, FR2, FR5, FR6, FR9, FR11, FR12, FR25, FR26 (Smart Interaction)
   - Epic 3: FR13, FR14, FR15, FR18, FR19, FR21, FR22, FR24 (Automation & QC)
   - Epic 4: FR7 (History)

  Do you approve this revised epic structure for proceeding to story creation?

  Select an Option: [A] Advanced Elicitation [P] Party Mode [C] Continue

> move geocoding to epic 3 (it's google maps/nominatim api, cloud-related). the rest is good to go. make sure you dont miss any FR

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  Edit _bmad-output/.../epics.md: ### FR Coverage Map... => ### FR Coverage Map...                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│  83                                                                                                                                                                                                                                                                                     │
│  84   ### FR Coverage Map                                                                                                                                                                                                                                                               │
│  85                                                                                                                                                                                                                                                                                     │
│  86 - {{requirements_coverage_map}}                                                                                                                                                                                                                                                     │
│  86 + FR1: Epic 2 - Seekers can navigate directly via GeoID.                                                                                                                                                                                                                            │
│  87 + FR2: Epic 2 - Seekers can build queries with chips.                                                                                                                                                                                                                               │
│  88 + FR3: Epic 1 - Seekers can perform keyword searches.                                                                                                                                                                                                                               │
│  89 + FR4: Epic 1 - Seekers can filter by Price, Ward, District.                                                                                                                                                                                                                        │
│  90 + FR5: Epic 2 - Seekers can view property map.                                                                                                                                                                                                                                      │
│  91 + FR6: Epic 2 - Seekers can toggle search modes.                                                                                                                                                                                                                                    │
│  92 + FR7: Epic 4 - Seekers can view historical price timeline.                                                                                                                                                                                                                         │
│  93 + FR8: Epic 1 - Seekers can view 'Real View' and 'Cons'.                                                                                                                                                                                                                            │
│  94 + FR9: Epic 2 - Seekers can initiate Zalo chat with Admin.                                                                                                                                                                                                                          │
│  95 + FR10: Epic 1 - Landlords can share via human-readable URLs.                                                                                                                                                                                                                       │
│  96 + FR11: Epic 2 - Users must pass a Login Wall for contact info.                                                                                                                                                                                                                     │
│  97 + FR12: Epic 2 - Users can trigger pre-filled Zalo messages with GeoID.                                                                                                                                                                                                             │
│  98 + FR13: Epic 3 - System autonomously ingests social posts.                                                                                                                                                                                                                          │
│  99 + FR14: Epic 3 - System transforms unstructured text to structured data.                                                                                                                                                                                                            │
│ 100 + FR15: Epic 3 - System identifies unique properties via fingerprinting.                                                                                                                                                                                                            │
│ 101 + FR16: Epic 1 - System generates unique, hierarchical GeoIDs.                                                                                                                                                                                                                      │
│ 102 + FR17: Epic 3 - System geocodes addresses with fallback logic.                                                                                                                                                                                                                     │
│ 103 + FR18: Epic 3 - System rewrites descriptions using AI.                                                                                                                                                                                                                             │
│ 104 + FR19: Epic 3 - Admins can review data side-by-side.                                                                                                                                                                                                                               │
│ 105 + FR20: Epic 1 - Admins can manually override and edit attributes.                                                                                                                                                                                                                  │
│ 106 + FR21: Epic 3 - Admins can approve or reject pending listings.                                                                                                                                                                                                                     │
│ 107 + FR22: Epic 3 - Admins can view fingerprint collision alerts.                                                                                                                                                                                                                      │
│ 108 + FR23: Epic 1 - Admins can manage available/rented status.                                                                                                                                                                                                                         │
│ 109 + FR24: Epic 3 - System can auto-ban non-human scrapers via Honeypots.                                                                                                                                                                                                              │
│ 110 + FR25: Epic 2 - System rate-limits contact information views.                                                                                                                                                                                                                      │
│ 111 + FR26: Epic 2 - System enforces login wall for owner details.                                                                                                                                                                                                                      │
│ 112 + FR27: Epic 1 - Admins can manually input listings (individually or in bulk).                                                                                                                                                                                                      │
│ 113                                                                                                                                                                                                                                                                                     │
│ 114   ## Epic List                                                                                                                                                                                                                                                                      │
│ 115                                                                                                                                                                                                                                                                                     │
│  90 - {{epics_list}}                                                                                                                                                                                                                                                                    │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 116 + ### Epic 1: The Manual MVP (Core Listing & Viewing)                                                                                                                                                                                                                               │
│ 117 + Build the essential manual platform where Admins can create listings by hand and Seekers can discover and view them. Validates the core data model and user experience.                                                                                                           │
│ 118 + **FRs covered:** FR3, FR4, FR8, FR10, FR16, FR20, FR23, FR27.                                                                                                                                                                                                                     │
│ 119 +                                                                                                                                                                                                                                                                                   │
│ 120 + ### Epic 2: The "Smart" Search & Interaction                                                                                                                                                                                                                                      │
│ 121 + Enhance the seeker experience with the innovative "Smart Waterfall Search" (GeoID jumps, Guided Chips) and secure contact flows.                                                                                                                                                  │
│ 122 + **FRs covered:** FR1, FR2, FR5, FR6, FR9, FR11, FR12, FR25, FR26.                                                                                                                                                                                                                 │
│ 123 +                                                                                                                                                                                                                                                                                   │
│ 124 + ### Epic 3: Automated Data Refinery & Geocoding                                                                                                                                                                                                                                   │
│ 125 + Introduce the high-throughput automation layer and cloud-based geocoding services to scale listing acquisition.                                                                                                                                                                   │
│ 126 + **FRs covered:** FR13, FR14, FR15, FR17, FR18, FR19, FR21, FR22, FR24.                                                                                                                                                                                                            │
│ 127 +                                                                                                                                                                                                                                                                                   │
│ 128 + ### Epic 4: The Time Machine (Transparency & History)                                                                                                                                                                                                                             │
│ 129 + Implement SCD Type 2 tracking to visualize historical price trends for properties.                                                                                                                                                                                                │
│ 130 + **FRs covered:** FR7.                                                                                                                                                                                                                                                             │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ The Epic List and FR Coverage Map have been updated to reflect the "Manual First" MVP structure, with geocoding (FR17) moved to the Automated Refinery (Epic 3).

  Epic List Summary:
   - Epic 1: The Manual MVP (Core Listing & Viewing) - Focused on manual admin entry and basic seeker discovery.
   - Epic 2: The "Smart" Search & Interaction - Adds the Waterfall Search Bar and secure Zalo flows.
   - Epic 3: Automated Data Refinery & Geocoding - Scales the platform with scraping, AI transformation, and cloud geocoding.
   - Epic 4: The Time Machine (Transparency & History) - Adds historical price tracking.

  Select an Option to proceed to Story Creation:
   - [C] Continue
   - [A] Advanced Elicitation
   - [P] Party Mode

> continue

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  Edit _bmad-output/.../epics.md: ---... => ---...                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ 1   ---                                                                                                                                                                                                                                                                                 │
│ 2 - stepsCompleted: [1]                                                                                                                                                                                                                                                                 │
│ 2 + stepsCompleted: [1, 2]                                                                                                                                                                                                                                                              │
│ 3   inputDocuments:                                                                                                                                                                                                                                                                     │
│ 4     - _bmad-output/planning-artifacts/prd.md                                                                                                                                                                                                                                          │
│ 5     - _bmad-output/planning-artifacts/architecture.md                                                                                                                                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFile _bmad/.../step-03-create-stories.md                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ We will now generate stories for each epic, following the template structure. We'll process them sequentially, starting with Epic 1.

  ---

  Epic 1: The Manual MVP (Core Listing & Viewing)
  Goal: Build the essential manual platform where Admins can create listings by hand and Seekers can discover and view them. Validates the core data model and user experience.
  FRs covered: FR3, FR4, FR8, FR10, FR16, FR20, FR23, FR27.

  Proposed Story Breakdown for Epic 1:

   * Story 1.1: Project Scaffolding & Database Foundation
       * Set up the Turborepo monorepo, initialize FastAPI and React apps, and create the core Supabase schema for Houses and Rooms (SCD Type 2 base).
   * Story 1.2: Admin Manual Listing Creation (FR27, FR16)
       * Implement the Admin interface to manually input a new listing (House + Room) with automatic GeoID generation and address fingerprinting.
   * Story 1.3: Seeker Discovery Grid & Keyword Search (FR3, FR4)
       * Create the public-facing listing grid with a simple keyword search and basic filters (Price, Ward, District).
   * Story 1.4: Property Detail View & Metadata (FR8, FR10)
       * Implement the detail page showing "Real View," "Cons," and metadata, with shareable human-readable URLs.
   * Story 1.5: Admin Listing Management (FR20, FR23)
       * Allow Admins to edit existing listing attributes and toggle status (Available/Rented).

  ---

  Story 1.1: Project Scaffolding & Database Foundation

  As a Developer,
  I want to set up the monorepo and core database schema,
  So that I have a solid foundation for implementing features.

  Acceptance Criteria:

  Given a clean project directory
  When I run the initialization commands
  Then a Turborepo monorepo is created with apps/web (Vite/React), apps/api (FastAPI), and packages/scraper
  And pnpm and uv are configured for dependency management

  Given a Supabase project
  When I apply the initial Alembic migrations
  Then the houses and rooms tables are created with support for JSONB attributes and SCD Type 2 history (tracking changes via valid_from/valid_to)

  ---

  Story 1.2: Admin Manual Listing Creation

  As an Admin (Minh),
  I want to manually input a new property listing,
  So that I can start building the platform's data without automation.

  Acceptance Criteria:

  Given I am logged into the Admin interface
  When I enter a property address and details (Price, Ward, District, Specs)
  Then the system checks for address fingerprint collisions
  And generates a unique hierarchical GeoID (e.g., 29CG.W8K01)
  And creates a new House and Room record in the database

  ---

  Minh, does this breakdown for Epic 1 look correct to you? Once you approve, I will append these to the `epics.md` file and move to Epic 2.

> approve, please continue

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  WriteFile Writing to _bmad-output/.../epics.md                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
│   1 - ---                                                                                                                                                                                                                                                                               │
│   2 - stepsCompleted: [1, 2]                                                                                                                                                                                                                                                            │
│   3 - inputDocuments:                                                                                                                                                                                                                                                                   │
│   4 -   - _bmad-output/planning-artifacts/prd.md                                                                                                                                                                                                                                        │
│   5 -   - _bmad-output/planning-artifacts/architecture.md                                                                                                                                                                                                                               │
│   6 -   - _bmad-output/planning-artifacts/ux-design-specification.md                                                                                                                                                                                                                    │
│   7 - ---                                                                                                                                                                                                                                                                               │
│   1 + ## Epic 1: The Manual MVP (Core Listing & Viewing)                                                                                                                                                                                                                                │
│   2                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│   9 - # nhaminhbach - Epic Breakdown                                                                                                                                                                                                                                                    │
│   3 + Build the essential manual platform where Admins can create listings by hand and Seekers can discover and view them. Validates the core data model and user experience.                                                                                                           │
│   4                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  11 - ## Overview                                                                                                                                                                                                                                                                       │
│   5 + ### Story 1.1: Project Scaffolding & Database Foundation                                                                                                                                                                                                                          │
│   6                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  13 - This document provides the complete epic and story breakdown for nhaminhbach, decomposing the requirements from the PRD, UX Design if it exists, and Architecture requirements into implementable stories.                                                                        │
│   7 + As a Developer,                                                                                                                                                                                                                                                                   │
│   8 + I want to set up the monorepo and core database schema,                                                                                                                                                                                                                           │
│   9 + So that I have a solid foundation for implementing features.                                                                                                                                                                                                                      │
│  10                                                                                                                                                                                                                                                                                     │
│  15 - ## Requirements Inventory                                                                                                                                                                                                                                                         │
│  11 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│  12                                                                                                                                                                                                                                                                                     │
│  17 - ### Functional Requirements                                                                                                                                                                                                                                                       │
│  13 + **Given** a clean project directory                                                                                                                                                                                                                                               │
│  14 + **When** I run the initialization commands                                                                                                                                                                                                                                        │
│  15 + **Then** a Turborepo monorepo is created with `apps/web` (Vite/React), `apps/api` (FastAPI), and `packages/scraper`                                                                                                                                                               │
│  16 + **And** `pnpm` and `uv` are configured for dependency management                                                                                                                                                                                                                  │
│  17 + **And** the project directory structure matches the architectural design document                                                                                                                                                                                                 │
│  18                                                                                                                                                                                                                                                                                     │
│  19 - FR1: Seekers can navigate directly to a specific property using a unique GeoID.                                                                                                                                                                                                   │
│  20 - FR2: Seekers can build logical queries using a guided token-based interface (chips).                                                                                                                                                                                              │
│  21 - FR3: Seekers can perform standard keyword searches across property descriptions.                                                                                                                                                                                                  │
│  22 - FR4: Seekers can filter property results by Price Range, Ward, and District.                                                                                                                                                                                                      │
│  23 - FR5: Seekers can view a map representation of property locations (pin or circle based on accuracy).                                                                                                                                                                               │
│  24 - FR6: Seekers can toggle between a "Guided Query" mode and standard keyword search.                                                                                                                                                                                                │
│  25 - FR7: Seekers can view a historical price timeline for a specific room (The "Time Machine").                                                                                                                                                                                       │
│  26 - FR8: Seekers can view "Góc nhìn thật" (Real view) and "Điểm trừ" (Cons) metadata for any listing.                                                                                                                                                                                 │
│  27 - FR9: Seekers can initiate a direct Zalo chat with the Platform Admin (Minh) regarding a specific property.                                                                                                                                                                        │
│  28 - FR10: Landlords can share their specific property or portfolio via a human-readable alias URL.                                                                                                                                                                                    │
│  29 - FR11: Users can view property contact information only after passing a "Login Wall" or verification gate.                                                                                                                                                                         │
│  30 - FR12: Users can trigger a pre-filled Zalo message template containing the property's GeoID.                                                                                                                                                                                       │
│  31 - FR13: The System can autonomously ingest raw rental posts from social media sources.                                                                                                                                                                                              │
│  32 - FR14: The System can transform unstructured Vietnamese text into structured property data.                                                                                                                                                                                        │
│  33 - FR15: The System can identify unique physical properties across multiple social posts using address/phone fingerprinting.                                                                                                                                                         │
│  34 - FR16: The System can automatically generate unique, hierarchical GeoIDs for new properties.                                                                                                                                                                                       │
│  35 - FR17: The System can geocode structured addresses into geographic coordinates using a fallback sequence.                                                                                                                                                                          │
│  36 - FR18: The System can rewrite social media descriptions into unique platform content using AI.                                                                                                                                                                                     │
│  37 - FR19: Admins can review ingested data in a side-by-side comparison interface (Raw vs. Refined).                                                                                                                                                                                   │
│  38 - FR20: Admins can manually override and edit any attribute of a listing before approval.                                                                                                                                                                                           │
│  39 - FR21: Admins can approve or reject pending listings with a single action.                                                                                                                                                                                                         │
│  40 - FR22: Admins can view fingerprint collision alerts for properties that have appeared historically.                                                                                                                                                                                │
│  41 - FR23: Admins can manage the "Available/Rented" status of any room in the system.                                                                                                                                                                                                  │
│  42 - FR27: Admins can manually input new listings (individually or in bulk) via the admin interface, reusing the manual edit components.                                                                                                                                               │
│  43 - FR24: The System can identify and auto-ban non-human scraping agents via invisible "Honeypot" links.                                                                                                                                                                              │
│  44 - FR25: The System can rate-limit the viewing of sensitive contact information per user.                                                                                                                                                                                            │
│  45 - FR26: The System can enforce a "Login Wall" for accessing owner/admin contact details.                                                                                                                                                                                            │
│  19 + **Given** a Supabase project                                                                                                                                                                                                                                                      │
│  20 + **When** I apply the initial Alembic migrations                                                                                                                                                                                                                                   │
│  21 + **Then** the `houses` and `rooms` tables are created with support for JSONB attributes                                                                                                                                                                                            │
│  22 + **And** the schema supports SCD Type 2 history (tracking changes via `valid_from`/`valid_to`)                                                                                                                                                                                     │
│  23                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  47 - ### NonFunctional Requirements                                                                                                                                                                                                                                                    │
│  24 + ### Story 1.2: Admin Manual Listing Creation                                                                                                                                                                                                                                      │
│  25                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  49 - NFR1: Short ID Resolution: Entering a GeoID in the search bar must resolve to the property page in < 300ms (network excluding).                                                                                                                                                   │
│  50 - NFR2: Search Intent Latency: Transforming natural language to a logical query and returning results must complete in < 800ms.                                                                                                                                                     │
│  51 - NFR3: First Contentful Paint (FCP): The public landing page must load in < 1.5s on a standard 4G connection in Hanoi.                                                                                                                                                             │
│  52 - NFR4: Mobile Smoothness: Touch interactions (scrolling, chip selection) must maintain 60fps to ensure a "Zalo-like" responsive feel.                                                                                                                                              │
│  53 - NFR5: Data Protection (Smart Gating): Owner contact information must be protected behind a rate-limiting gate (e.g., maximum 5 contact views per day per user).                                                                                                                   │
│  54 - NFR6: Competitor Defense: Implement Honeypot link detection that automatically blacklists IPs demonstrating bulk-scraping behavior within < 10 seconds of detection.                                                                                                              │
│  55 - NFR7: Data Integrity: All LLM-generated data must pass Pydantic schema validation before being committed to Supabase to prevent data corruption.                                                                                                                                  │
│  56 - NFR8: Admin Security: Minh's access to the QC Cockpit must be secured via Multi-Factor Authentication (MFA) or Zalo Social Login.                                                                                                                                                 │
│  57 - NFR9: Horizontal Scraping: The GCP pipeline must support scaling to 50+ concurrent Cloud Run instances to handle regional expansion without architectural changes.                                                                                                                │
│  58 - NFR10: Storage Strategy: Supabase storage must handle up to 100,000 active listings with price history without query performance degradation (using proper indexing on full_geo_id and address_hash).                                                                             │
│  59 - NFR11: Refinery Throughput: The transformation engine must be capable of processing 1,000+ social media posts daily without human intervention bottlenecking the pipeline.                                                                                                        │
│  60 - NFR12: SLA Freshness: Data ingested from social media must be processed and ready for verification in < 24 hours.                                                                                                                                                                 │
│  61 - NFR13: Transactional Consistency: 100% of listing creations must be Atomic (House + Room + History) to prevent partial data states.                                                                                                                                               │
│  26 + As an Admin (Minh),                                                                                                                                                                                                                                                               │
│  27 + I want to manually input a new property listing,                                                                                                                                                                                                                                  │
│  28 + So that I can start building the platform's data without automation.                                                                                                                                                                                                              │
│  29                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  63 - ### Additional Requirements                                                                                                                                                                                                                                                       │
│  30 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│  31                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  65 - **From Architecture:**                                                                                                                                                                                                                                                            │
│  66 - - **Starter Template:** Use the Custom Turborepo Construction with `pnpm` workspaces for React (Vite), FastAPI, and Docker (Scraper).                                                                                                                                             │
│  67 - - **Data Modeling:** Use JSONB for property attributes in PostgreSQL, validated by Pydantic v2.                                                                                                                                                                                   │
│  68 - - **Migrations:** Use Alembic (v1.18.2) for schema evolution.                                                                                                                                                                                                                     │
│  69 - - **Identity & Auth:** Use Supabase Auth for user-facing services and Shared API Secret (`X-NHB-SECRET`) for Scraper-to-API communication.                                                                                                                                        │
│  70 - - **Frontend State:** Use TanStack Query (v5.x) for server state and Zustand (v5.x) for client state (Search Bar).                                                                                                                                                                │
│  71 - - **Deployment:** Docker-First for Scraper, Vercel for App Tier.                                                                                                                                                                                                                  │
│  72 - - **Naming Conventions:** Strict adherence to defined naming (camelCase JSON, snake_case DB/Python) and structure patterns.                                                                                                                                                       │
│  73 - - **Error Handling:** Standardized Error Objects for API responses.                                                                                                                                                                                                               │
│  32 + **Given** I am logged into the Admin interface                                                                                                                                                                                                                                    │
│  33 + **When** I enter a property address and details (Price, Ward, District, Specs) and submit                                                                                                                                                                                         │
│  34 + **Then** the system checks for address fingerprint collisions                                                                                                                                                                                                                     │
│  35 + **And** generates a unique hierarchical GeoID (e.g., `29CG.W8K01`)                                                                                                                                                                                                                │
│  36 + **And** creates a new House and Room record in the database                                                                                                                                                                                                                       │
│  37 + **And** the new listing is saved with status "Available"                                                                                                                                                                                                                          │
│  38                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  75 - **From UX Design:**                                                                                                                                                                                                                                                               │
│  76 - - **Responsive Design:** Mobile-First SPA optimized for 360px-420px viewports.                                                                                                                                                                                                    │
│  77 - - **Interaction:** "Smart Waterfall Search Bar" logic (GeoID -> Chips -> Keyword).                                                                                                                                                                                                │
│  78 - - **Touch Targets:** Minimum 44px hit area for all interactive elements.                                                                                                                                                                                                          │
│  79 - - **Aesthetic:** "Future Warmth" palette (Coral/Cream) and "Her" aesthetic (soft rounded corners).                                                                                                                                                                                │
│  80 - - **Component Strategy:** Use Headless UI wrapped in Tailwind CSS.                                                                                                                                                                                                                │
│  81 - - **Navigation:** Bottom Sheets for detail views on mobile; Gestures for closing.                                                                                                                                                                                                 │
│  82 - - **Accessibility:** Keyboard sovereignty for Search Bar; WCAG 2.1 AA contrast compliance.                                                                                                                                                                                        │
│  39 + ### Story 1.3: Seeker Discovery Grid & Keyword Search                                                                                                                                                                                                                             │
│  40                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  84 - ### FR Coverage Map                                                                                                                                                                                                                                                               │
│  41 + As a Seeker (Hương),                                                                                                                                                                                                                                                              │
│  42 + I want to browse available listings and search by keywords,                                                                                                                                                                                                                       │
│  43 + So that I can find properties that match my basic criteria.                                                                                                                                                                                                                       │
│  44                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│  86 - FR1: Epic 2 - Seekers can navigate directly via GeoID.                                                                                                                                                                                                                            │
│  87 - FR2: Epic 2 - Seekers can build queries with chips.                                                                                                                                                                                                                               │
│  88 - FR3: Epic 1 - Seekers can perform keyword searches.                                                                                                                                                                                                                               │
│  89 - FR4: Epic 1 - Seekers can filter by Price, Ward, District.                                                                                                                                                                                                                        │
│  90 - FR5: Epic 2 - Seekers can view property map.                                                                                                                                                                                                                                      │
│  91 - FR6: Epic 2 - Seekers can toggle search modes.                                                                                                                                                                                                                                    │
│  92 - FR7: Epic 4 - Seekers can view historical price timeline.                                                                                                                                                                                                                         │
│  93 - FR8: Epic 1 - Seekers can view 'Real View' and 'Cons'.                                                                                                                                                                                                                            │
│  94 - FR9: Epic 2 - Seekers can initiate Zalo chat with Admin.                                                                                                                                                                                                                          │
│  95 - FR10: Epic 1 - Landlords can share via human-readable URLs.                                                                                                                                                                                                                       │
│  96 - FR11: Epic 2 - Users must pass a Login Wall for contact info.                                                                                                                                                                                                                     │
│  97 - FR12: Epic 2 - Users can trigger pre-filled Zalo messages with GeoID.                                                                                                                                                                                                             │
│  98 - FR13: Epic 3 - System autonomously ingests social posts.                                                                                                                                                                                                                          │
│  99 - FR14: Epic 3 - System transforms unstructured text to structured data.                                                                                                                                                                                                            │
│ 100 - FR15: Epic 3 - System identifies unique properties via fingerprinting.                                                                                                                                                                                                            │
│ 101 - FR16: Epic 1 - System generates unique, hierarchical GeoIDs.                                                                                                                                                                                                                      │
│ 102 - FR17: Epic 3 - System geocodes addresses with fallback logic.                                                                                                                                                                                                                     │
│ 103 - FR18: Epic 3 - System rewrites descriptions using AI.                                                                                                                                                                                                                             │
│ 104 - FR19: Epic 3 - Admins can review data side-by-side.                                                                                                                                                                                                                               │
│ 105 - FR20: Epic 1 - Admins can manually override and edit attributes.                                                                                                                                                                                                                  │
│ 106 - FR21: Epic 3 - Admins can approve or reject pending listings.                                                                                                                                                                                                                     │
│ 107 - FR22: Epic 3 - Admins can view fingerprint collision alerts.                                                                                                                                                                                                                      │
│ 108 - FR23: Epic 1 - Admins can manage available/rented status.                                                                                                                                                                                                                         │
│ 109 - FR24: Epic 3 - System can auto-ban non-human scrapers via Honeypots.                                                                                                                                                                                                              │
│ 110 - FR25: Epic 2 - System rate-limits contact information views.                                                                                                                                                                                                                      │
│ 111 - FR26: Epic 2 - System enforces login wall for owner details.                                                                                                                                                                                                                      │
│ 112 - FR27: Epic 1 - Admins can manually input listings (individually or in bulk).                                                                                                                                                                                                      │
│  45 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│  46                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 114 - ## Epic List                                                                                                                                                                                                                                                                      │
│  47 + **Given** I am on the home page                                                                                                                                                                                                                                                   │
│  48 + **When** I enter a keyword (e.g., "bancony") or select basic filters (Price Range, Ward)                                                                                                                                                                                          │
│  49 + **Then** the grid updates to show matching "Available" listings                                                                                                                                                                                                                   │
│  50 + **And** each card displays the Price, Location, and key specs                                                                                                                                                                                                                     │
│  51 + **And** the response time is responsive (< 1.5s FCP)                                                                                                                                                                                                                              │
│  52                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 116 - ### Epic 1: The Manual MVP (Core Listing & Viewing)                                                                                                                                                                                                                               │
│ 117 - Build the essential manual platform where Admins can create listings by hand and Seekers can discover and view them. Validates the core data model and user experience.                                                                                                           │
│ 118 - **FRs covered:** FR3, FR4, FR8, FR10, FR16, FR20, FR23, FR27.                                                                                                                                                                                                                     │
│  53 + ### Story 1.4: Property Detail View & Metadata                                                                                                                                                                                                                                    │
│  54                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 120 - ### Epic 2: The "Smart" Search & Interaction                                                                                                                                                                                                                                      │
│ 121 - Enhance the seeker experience with the innovative "Smart Waterfall Search" (GeoID jumps, Guided Chips) and secure contact flows.                                                                                                                                                  │
│ 122 - **FRs covered:** FR1, FR2, FR5, FR6, FR9, FR11, FR12, FR25, FR26.                                                                                                                                                                                                                 │
│  55 + As a Seeker (Hương),                                                                                                                                                                                                                                                              │
│  56 + I want to view the full details of a property, including honest "Cons" and "Real View" images,                                                                                                                                                                                    │
│  57 + So that I can make an informed decision without visiting.                                                                                                                                                                                                                         │
│  58                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 124 - ### Epic 3: Automated Data Refinery & Geocoding                                                                                                                                                                                                                                   │
│ 125 - Introduce the high-throughput automation layer and cloud-based geocoding services to scale listing acquisition.                                                                                                                                                                   │
│ 126 - **FRs covered:** FR13, FR14, FR15, FR17, FR18, FR19, FR21, FR22, FR24.                                                                                                                                                                                                            │
│  59 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│  60                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 128 - ### Epic 4: The Time Machine (Transparency & History)                                                                                                                                                                                                                             │
│ 129 - Implement SCD Type 2 tracking to visualize historical price trends for properties.                                                                                                                                                                                                │
│ 130 - **FRs covered:** FR7.                                                                                                                                                                                                                                                             │
│  61 + **Given** I click on a listing card                                                                                                                                                                                                                                               │
│  62 + **When** the detail page loads                                                                                                                                                                                                                                                    │
│  63 + **Then** I see the full address, structured specs, "Real View" images, and "Cons" list                                                                                                                                                                                            │
│  64 + **And** the URL is human-readable (e.g., `/listing/29CG.W8K01`) and shareable                                                                                                                                                                                                     │
│  65 +                                                                                                                                                                                                                                                                                   │
│  66 + ### Story 1.5: Admin Listing Management                                                                                                                                                                                                                                           │
│  67 +                                                                                                                                                                                                                                                                                   │
│  68 + As an Admin (Minh),                                                                                                                                                                                                                                                               │
│  69 + I want to edit existing listing attributes and manage their status,                                                                                                                                                                                                               │
│  70 + So that I can keep the platform data accurate and up-to-date.                                                                                                                                                                                                                     │
│  71 +                                                                                                                                                                                                                                                                                   │
│  72 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│  73 +                                                                                                                                                                                                                                                                                   │
│  74 + **Given** I am viewing a listing in the Admin interface                                                                                                                                                                                                                           │
│  75 + **When** I update a field (e.g., Price) or toggle status to "Rented"                                                                                                                                                                                                              │
│  76 + **Then** the change is saved immediately to the database                                                                                                                                                                                                                          │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ I've started the epics.md file with Epic 1 and its stories. Note that I overwrote the previous file content to start building the final document structure properly (appending would have duplicated the header). I will now re-add the header and requirement sections before we proceed
  to Epic 2, to ensure the full template structure is maintained.

  Wait, I should have appended to the file after the header section I created in Step 1. Let me quickly correct the file structure to match the template exactly: Header -> Requirements -> Coverage Map -> Epic List -> Epic 1.

  I will read the current file content to ensure I haven't lost the requirements sections. If I have, I will restore them.

  Then we will move to Epic 2: The "Smart" Search & Interaction.

  Epic 2 Goal: Enhance the seeker experience with the innovative "Smart Waterfall Search" (GeoID jumps, Guided Chips) and secure contact flows.
  FRs covered: FR1, FR2, FR5, FR6, FR9, FR11, FR12, FR25, FR26.

  Proposed Story Breakdown for Epic 2:

   * Story 2.1: Smart Search Bar State Machine (FR1, FR6)
       * Implement the "Waterfall Dispatcher" logic in the frontend to detect GeoID patterns vs. Keywords vs. Chips.
   * Story 2.2: Guided Query Chips (FR2)
       * Implement the UI/UX for auto-suggesting filter chips as the user types (e.g., typing "3" suggests "Price < 3m").
   * Story 2.3: GeoID "Teleport" Navigation (FR1)
       * Implement the backend resolution endpoint GET /resolve/{geoid} and the frontend transition for instant navigation.
   * Story 2.4: Secure Contact & Login Wall (FR11, FR26)
       * Implement the "Login Wall" that hides sensitive contact info until a user authenticates or verifies.
   * Story 2.5: Zalo Integration & Rate Limiting (FR9, FR12, FR25)
       * Implement the deep-link generation with pre-filled messages and enforce the 5-views-per-day rate limit.

  Does this breakdown for Epic 2 look correct?

> wait, you rewrie the whole file! undo now, and append again

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  WriteFile Writing to _bmad-output/.../epics.md                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
│   1 + ---                                                                                                                                                                                                                                                                               │
│   2 + stepsCompleted: [1, 2]                                                                                                                                                                                                                                                            │
│   3 + inputDocuments:                                                                                                                                                                                                                                                                   │
│   4 +   - _bmad-output/planning-artifacts/prd.md                                                                                                                                                                                                                                        │
│   5 +   - _bmad-output/planning-artifacts/architecture.md                                                                                                                                                                                                                               │
│   6 +   - _bmad-output/planning-artifacts/ux-design-specification.md                                                                                                                                                                                                                    │
│   7 + ---                                                                                                                                                                                                                                                                               │
│   8 +                                                                                                                                                                                                                                                                                   │
│   9 + # nhaminhbach - Epic Breakdown                                                                                                                                                                                                                                                    │
│  10 +                                                                                                                                                                                                                                                                                   │
│  11 + ## Overview                                                                                                                                                                                                                                                                       │
│  12 +                                                                                                                                                                                                                                                                                   │
│  13 + This document provides the complete epic and story breakdown for nhaminhbach, decomposing the requirements from the PRD, UX Design if it exists, and Architecture requirements into implementable stories.                                                                        │
│  14 +                                                                                                                                                                                                                                                                                   │
│  15 + ## Requirements Inventory                                                                                                                                                                                                                                                         │
│  16 +                                                                                                                                                                                                                                                                                   │
│  17 + ### Functional Requirements                                                                                                                                                                                                                                                       │
│  18 +                                                                                                                                                                                                                                                                                   │
│  19 + FR1: Seekers can navigate directly to a specific property using a unique GeoID.                                                                                                                                                                                                   │
│  20 + FR2: Seekers can build logical queries using a guided token-based interface (chips).                                                                                                                                                                                              │
│  21 + FR3: Seekers can perform standard keyword searches across property descriptions.                                                                                                                                                                                                  │
│  22 + FR4: Seekers can filter property results by Price Range, Ward, and District.                                                                                                                                                                                                      │
│  23 + FR5: Seekers can view a map representation of property locations (pin or circle based on accuracy).                                                                                                                                                                               │
│  24 + FR6: Seekers can toggle between a "Guided Query" mode and standard keyword search.                                                                                                                                                                                                │
│  25 + FR7: Seekers can view a historical price timeline for a specific room (The "Time Machine").                                                                                                                                                                                       │
│  26 + FR8: Seekers can view "Góc nhìn thật" (Real view) and "Điểm trừ" (Cons) metadata for any listing.                                                                                                                                                                                 │
│  27 + FR9: Seekers can initiate a direct Zalo chat with the Platform Admin (Minh) regarding a specific property.                                                                                                                                                                        │
│  28 + FR10: Landlords can share their specific property or portfolio via a human-readable alias URL.                                                                                                                                                                                    │
│  29 + FR11: Users can view property contact information only after passing a "Login Wall" or verification gate.                                                                                                                                                                         │
│  30 + FR12: Users can trigger a pre-filled Zalo message template containing the property's GeoID.                                                                                                                                                                                       │
│  31 + FR13: The System can autonomously ingest raw rental posts from social media sources.                                                                                                                                                                                              │
│  32 + FR14: The System can transform unstructured Vietnamese text into structured property data.                                                                                                                                                                                        │
│  33 + FR15: The System can identify unique physical properties across multiple social posts using address/phone fingerprinting.                                                                                                                                                         │
│  34 + FR16: The System can automatically generate unique, hierarchical GeoIDs for new properties.                                                                                                                                                                                       │
│  35 + FR17: The System can geocode structured addresses into geographic coordinates using a fallback sequence.                                                                                                                                                                          │
│  36 + FR18: The System can rewrite social media descriptions into unique platform content using AI.                                                                                                                                                                                     │
│  37 + FR19: Admins can review ingested data in a side-by-side comparison interface (Raw vs. Refined).                                                                                                                                                                                   │
│  38 + FR20: Admins can manually override and edit any attribute of a listing before approval.                                                                                                                                                                                           │
│  39 + FR21: Admins can approve or reject pending listings with a single action.                                                                                                                                                                                                         │
│  40 + FR22: Admins can view fingerprint collision alerts for properties that have appeared historically.                                                                                                                                                                                │
│  41 + FR23: Admins can manage the "Available/Rented" status of any room in the system.                                                                                                                                                                                                  │
│  42 + FR24: The System can identify and auto-ban non-human scraping agents via invisible "Honeypot" links.                                                                                                                                                                              │
│  43 + FR25: The System can rate-limit the viewing of sensitive contact information per user.                                                                                                                                                                                            │
│  44 + FR26: The System can enforce a "Login Wall" for accessing owner/admin contact details.                                                                                                                                                                                            │
│  45 + FR27: Admins can manually input new listings (individually or in bulk) via the admin interface, reusing the manual edit components.                                                                                                                                               │
│  46 +                                                                                                                                                                                                                                                                                   │
│  47 + ### NonFunctional Requirements                                                                                                                                                                                                                                                    │
│  48 +                                                                                                                                                                                                                                                                                   │
│  49 + NFR1: Short ID Resolution: Entering a GeoID in the search bar must resolve to the property page in < 300ms (network excluding).                                                                                                                                                   │
│  50 + NFR2: Search Intent Latency: Transforming natural language to a logical query and returning results must complete in < 800ms.                                                                                                                                                     │
│  51 + NFR3: First Contentful Paint (FCP): The public landing page must load in < 1.5s on a standard 4G connection in Hanoi.                                                                                                                                                             │
│  52 + NFR4: Mobile Smoothness: Touch interactions (scrolling, chip selection) must maintain 60fps to ensure a "Zalo-like" responsive feel.                                                                                                                                              │
│  53 + NFR5: Data Protection (Smart Gating): Owner contact information must be protected behind a rate-limiting gate (e.g., maximum 5 contact views per day per user).                                                                                                                   │
│  54 + NFR6: Competitor Defense: Implement Honeypot link detection that automatically blacklists IPs demonstrating bulk-scraping behavior within < 10 seconds of detection.                                                                                                              │
│  55 + NFR7: Data Integrity: All LLM-generated data must pass Pydantic schema validation before being committed to Supabase to prevent data corruption.                                                                                                                                  │
│  56 + NFR8: Admin Security: Minh's access to the QC Cockpit must be secured via Multi-Factor Authentication (MFA) or Zalo Social Login.                                                                                                                                                 │
│  57 + NFR9: Horizontal Scraping: The GCP pipeline must support scaling to 50+ concurrent Cloud Run instances to handle regional expansion without architectural changes.                                                                                                                │
│  58 + NFR10: Storage Strategy: Supabase storage must handle up to 100,000 active listings with price history without query performance degradation (using proper indexing on full_geo_id and address_hash).                                                                             │
│  59 + NFR11: Refinery Throughput: The transformation engine must be capable of processing 1,000+ social media posts daily without human intervention bottlenecking the pipeline.                                                                                                        │
│  60 + NFR12: SLA Freshness: Data ingested from social media must be processed and ready for verification in < 24 hours.                                                                                                                                                                 │
│  61 + NFR13: Transactional Consistency: 100% of listing creations must be Atomic (House + Room + History) to prevent partial data states.                                                                                                                                               │
│  62 +                                                                                                                                                                                                                                                                                   │
│  63 + ### Additional Requirements                                                                                                                                                                                                                                                       │
│  64 +                                                                                                                                                                                                                                                                                   │
│  65 + **From Architecture:**                                                                                                                                                                                                                                                            │
│  66 + - **Starter Template:** Use the Custom Turborepo Construction with pnpm workspaces for React (Vite), FastAPI, and Docker (Scraper).                                                                                                                                               │
│  67 + - **Data Modeling:** Use JSONB for property attributes in PostgreSQL, validated by Pydantic v2.                                                                                                                                                                                   │
│  68 + - **Migrations:** Use Alembic (v1.18.2) for schema evolution.                                                                                                                                                                                                                     │
│  69 + - **Identity & Auth:** Use Supabase Auth for user-facing services and Shared API Secret (X-NHB-SECRET) for Scraper-to-API communication.                                                                                                                                          │
│  70 + - **Frontend State:** Use TanStack Query (v5.x) for server state and Zustand (v5.x) for client state (Search Bar).                                                                                                                                                                │
│  71 + - **Deployment:** Docker-First for Scraper, Vercel for App Tier.                                                                                                                                                                                                                  │
│  72 + - **Naming Conventions:** Strict adherence to defined naming (camelCase JSON, snake_case DB/Python) and structure patterns.                                                                                                                                                       │
│  73 + - **Error Handling:** Standardized Error Objects for API responses.                                                                                                                                                                                                               │
│  74 +                                                                                                                                                                                                                                                                                   │
│  75 + **From UX Design:**                                                                                                                                                                                                                                                               │
│  76 + - **Responsive Design:** Mobile-First SPA optimized for 360px-420px viewports.                                                                                                                                                                                                    │
│  77 + - **Interaction:** "Smart Waterfall Search Bar" logic (GeoID -> Chips -> Keyword).                                                                                                                                                                                                │
│  78 + - **Touch Targets:** Minimum 44px hit area for all interactive elements.                                                                                                                                                                                                          │
│  79 + - **Aesthetic:** "Future Warmth" palette (Coral/Cream) and "Her" aesthetic (soft rounded corners).                                                                                                                                                                                │
│  80 + - **Component Strategy:** Use Headless UI wrapped in Tailwind CSS.                                                                                                                                                                                                                │
│  81 + - **Navigation:** Bottom Sheets for detail views on mobile; Gestures for closing.                                                                                                                                                                                                 │
│  82 + - **Accessibility:** Keyboard sovereignty for Search Bar; WCAG 2.1 AA contrast compliance.                                                                                                                                                                                        │
│  83 +                                                                                                                                                                                                                                                                                   │
│  84 + ### FR Coverage Map                                                                                                                                                                                                                                                               │
│  85 +                                                                                                                                                                                                                                                                                   │
│  86 + FR1: Epic 2 - Seekers can navigate directly via GeoID.                                                                                                                                                                                                                            │
│  87 + FR2: Epic 2 - Seekers can build queries with chips.                                                                                                                                                                                                                               │
│  88 + FR3: Epic 1 - Seekers can perform keyword searches.                                                                                                                                                                                                                               │
│  89 + FR4: Epic 1 - Seekers can filter by Price, Ward, District.                                                                                                                                                                                                                        │
│  90 + FR5: Epic 2 - Seekers can view property map.                                                                                                                                                                                                                                      │
│  91 + FR6: Epic 2 - Seekers can toggle search modes.                                                                                                                                                                                                                                    │
│  92 + FR7: Epic 4 - Seekers can view historical price timeline.                                                                                                                                                                                                                         │
│  93 + FR8: Epic 1 - Seekers can view 'Real View' and 'Cons'.                                                                                                                                                                                                                            │
│  94 + FR9: Epic 2 - Seekers can initiate Zalo chat with Admin.                                                                                                                                                                                                                          │
│  95 + FR10: Epic 1 - Landlords can share via human-readable URLs.                                                                                                                                                                                                                       │
│  96 + FR11: Epic 2 - Users must pass a Login Wall for contact info.                                                                                                                                                                                                                     │
│  97 + FR12: Epic 2 - Users can trigger pre-filled Zalo messages with GeoID.                                                                                                                                                                                                             │
│  98 + FR13: Epic 3 - System autonomously ingests social posts.                                                                                                                                                                                                                          │
│  99 + FR14: Epic 3 - System transforms unstructured text to structured data.                                                                                                                                                                                                            │
│ 100 + FR15: Epic 3 - System identifies unique properties via fingerprinting.                                                                                                                                                                                                            │
│ 101 + FR16: Epic 1 - System generates unique, hierarchical GeoIDs.                                                                                                                                                                                                                      │
│ 102 + FR17: Epic 3 - System geocodes addresses with fallback logic.                                                                                                                                                                                                                     │
│ 103 + FR18: Epic 3 - System rewrites descriptions using AI.                                                                                                                                                                                                                             │
│ 104 + FR19: Epic 3 - Admins can review data side-by-side.                                                                                                                                                                                                                               │
│ 105 + FR20: Epic 1 - Admins can manually override and edit attributes.                                                                                                                                                                                                                  │
│ 106 + FR21: Epic 3 - Admins can approve or reject pending listings.                                                                                                                                                                                                                     │
│ 107 + FR22: Epic 3 - Admins can view fingerprint collision alerts.                                                                                                                                                                                                                      │
│ 108 + FR23: Epic 1 - Admins can manage available/rented status.                                                                                                                                                                                                                         │
│ 109 + FR24: Epic 3 - System can auto-ban non-human scrapers via Honeypots.                                                                                                                                                                                                              │
│ 110 + FR25: Epic 2 - System rate-limits contact information views.                                                                                                                                                                                                                      │
│ 111 + FR26: Epic 2 - System enforces login wall for owner details.                                                                                                                                                                                                                      │
│ 112 + FR27: Epic 1 - Admins can manually input listings (individually or in bulk).                                                                                                                                                                                                      │
│ 113 +                                                                                                                                                                                                                                                                                   │
│ 114 + ## Epic List                                                                                                                                                                                                                                                                      │
│ 115 +                                                                                                                                                                                                                                                                                   │
│ 116 + ### Epic 1: The Manual MVP (Core Listing & Viewing)                                                                                                                                                                                                                               │
│ 117 + Build the essential manual platform where Admins can create listings by hand and Seekers can discover and view them. Validates the core data model and user experience.                                                                                                           │
│ 118 + **FRs covered:** FR3, FR4, FR8, FR10, FR16, FR20, FR23, FR27.                                                                                                                                                                                                                     │
│ 119 +                                                                                                                                                                                                                                                                                   │
│ 120 + ### Epic 2: The "Smart" Search & Interaction                                                                                                                                                                                                                                      │
│ 121 + Enhance the seeker experience with the innovative "Smart Waterfall Search" (GeoID jumps, Guided Chips) and secure contact flows.                                                                                                                                                  │
│ 122 + **FRs covered:** FR1, FR2, FR5, FR6, FR9, FR11, FR12, FR25, FR26.                                                                                                                                                                                                                 │
│ 123 +                                                                                                                                                                                                                                                                                   │
│ 124 + ### Epic 3: Automated Data Refinery & Geocoding                                                                                                                                                                                                                                   │
│ 125 + Introduce the high-throughput automation layer and cloud-based geocoding services to scale listing acquisition.                                                                                                                                                                   │
│ 126 + **FRs covered:** FR13, FR14, FR15, FR17, FR18, FR19, FR21, FR22, FR24.                                                                                                                                                                                                            │
│ 127 +                                                                                                                                                                                                                                                                                   │
│ 128 + ### Epic 4: The Time Machine (Transparency & History)                                                                                                                                                                                                                             │
│ 129 + Implement SCD Type 2 tracking to visualize historical price trends for properties.                                                                                                                                                                                                │
│ 130 + **FRs covered:** FR7.                                                                                                                                                                                                                                                             │
│ 131 +                                                                                                                                                                                                                                                                                   │
│ 132   ## Epic 1: The Manual MVP (Core Listing & Viewing)                                                                                                                                                                                                                                │
│ 133                                                                                                                                                                                                                                                                                     │
│ 134   Build the essential manual platform where Admins can create listings by hand and Seekers can discover and view them. Validates the core data model and user experience.                                                                                                           │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 143                                                                                                                                                                                                                                                                                     │
│ 144   **Given** a clean project directory                                                                                                                                                                                                                                               │
│ 145   **When** I run the initialization commands                                                                                                                                                                                                                                        │
│  15 - **Then** a Turborepo monorepo is created with `apps/web` (Vite/React), `apps/api` (FastAPI), and `packages/scraper`                                                                                                                                                               │
│  16 - **And** `pnpm` and `uv` are configured for dependency management                                                                                                                                                                                                                  │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 146 + **Then** a Turborepo monorepo is created with apps/web (Vite/React), apps/api (FastAPI), and packages/scraper                                                                                                                                                                     │
│ 147 + **And** pnpm and uv are configured for dependency management                                                                                                                                                                                                                      │
│ 148   **And** the project directory structure matches the architectural design document                                                                                                                                                                                                 │
│ 149                                                                                                                                                                                                                                                                                     │
│ 150   **Given** a Supabase project                                                                                                                                                                                                                                                      │
│ 151   **When** I apply the initial Alembic migrations                                                                                                                                                                                                                                   │
│  21 - **Then** the `houses` and `rooms` tables are created with support for JSONB attributes                                                                                                                                                                                            │
│  22 - **And** the schema supports SCD Type 2 history (tracking changes via `valid_from`/`valid_to`)                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 152 + **Then** the houses and rooms tables are created with support for JSONB attributes                                                                                                                                                                                                │
│ 153 + **And** the schema supports SCD Type 2 history (tracking changes via valid_from/valid_to)                                                                                                                                                                                         │
│ 154                                                                                                                                                                                                                                                                                     │
│ 155   ### Story 1.2: Admin Manual Listing Creation                                                                                                                                                                                                                                      │
│ 156                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 163   **Given** I am logged into the Admin interface                                                                                                                                                                                                                                    │
│ 164   **When** I enter a property address and details (Price, Ward, District, Specs) and submit                                                                                                                                                                                         │
│ 165   **Then** the system checks for address fingerprint collisions                                                                                                                                                                                                                     │
│  35 - **And** generates a unique hierarchical GeoID (e.g., `29CG.W8K01`)                                                                                                                                                                                                                │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 166 + **And** generates a unique hierarchical GeoID (e.g., 29CG.W8K01)                                                                                                                                                                                                                  │
│ 167   **And** creates a new House and Room record in the database                                                                                                                                                                                                                       │
│ 168   **And** the new listing is saved with status "Available"                                                                                                                                                                                                                          │
│ 169                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 192   **Given** I click on a listing card                                                                                                                                                                                                                                               │
│ 193   **When** the detail page loads                                                                                                                                                                                                                                                    │
│ 194   **Then** I see the full address, structured specs, "Real View" images, and "Cons" list                                                                                                                                                                                            │
│  64 - **And** the URL is human-readable (e.g., `/listing/29CG.W8K01`) and shareable                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 195 + **And** the URL is human-readable (e.g., /listing/29CG.W8K01) and shareable                                                                                                                                                                                                       │
│ 196                                                                                                                                                                                                                                                                                     │
│ 197   ### Story 1.5: Admin Listing Management                                                                                                                                                                                                                                           │
│ 198                                                                                                                                                                                                                                                                                     │
│ ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
│ 206   **When** I update a field (e.g., Price) or toggle status to "Rented"                                                                                                                                                                                                              │
│ 207   **Then** the change is saved immediately to the database                                                                                                                                                                                                                          │
│ 208   **And** if the status is "Rented", the listing disappears from the public search grid                                                                                                                                                                                             │
│  78 -                                                                                                                                                                                                                                                                                   │
│  79 - <!-- Repeat for each epic in epics_list (N = 1, 2, 3...) -->                                                                                                                                                                                                                      │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ I apologize for the error. I have restored the full content of epics.md including the Header, Requirements Inventory, Coverage Map, Epic List, and the Epic 1 stories we just discussed.

  We can now move to Epic 2: The "Smart" Search & Interaction.

  Epic 2 Goal: Enhance the seeker experience with the innovative "Smart Waterfall Search" (GeoID jumps, Guided Chips) and secure contact flows.
  FRs covered: FR1, FR2, FR5, FR6, FR9, FR11, FR12, FR25, FR26.

  Proposed Story Breakdown for Epic 2:

   * Story 2.1: Smart Search Bar State Machine (FR1, FR6)
       * Implement the "Waterfall Dispatcher" logic in the frontend to detect GeoID patterns vs. Keywords vs. Chips.
   * Story 2.2: Guided Query Chips (FR2)
       * Implement the UI/UX for auto-suggesting filter chips as the user types (e.g., typing "3" suggests "Price < 3m").
   * Story 2.3: GeoID "Teleport" Navigation (FR1)
       * Implement the backend resolution endpoint GET /resolve/{geoid} and the frontend transition for instant navigation.
   * Story 2.4: Secure Contact & Login Wall (FR11, FR26)
       * Implement the "Login Wall" that hides sensitive contact info until a user authenticates or verifies.
   * Story 2.5: Zalo Integration & Rate Limiting (FR9, FR12, FR25)
       * Implement the deep-link generation with pre-filled messages and enforce the 5-views-per-day rate limit.
   * Story 2.6: Map View of Listings (FR5)
       * Implement a map interface (using pins or circles) to visualize listing locations.

  Does this breakdown for Epic 2 look correct?

> yes

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFile _bmad-output/.../epics.md                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  Edit _bmad-output/.../epics.md: **And** if the status is "Rent... => **And** if the status is "Rent...                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                         │
│ 206   **When** I update a field (e.g., Price) or toggle status to "Rented"                                                                                                                                                                                                              │
│ 207   **Then** the change is saved immediately to the database                                                                                                                                                                                                                          │
│ 208   **And** if the status is "Rented", the listing disappears from the public search grid                                                                                                                                                                                             │
│ 209 +                                                                                                                                                                                                                                                                                   │
│ 210 + ## Epic 2: The "Smart" Search & Interaction                                                                                                                                                                                                                                       │
│ 211 +                                                                                                                                                                                                                                                                                   │
│ 212 + Enhance the seeker experience with the innovative "Smart Waterfall Search" (GeoID jumps, Guided Chips) and secure contact flows.                                                                                                                                                  │
│ 213 +                                                                                                                                                                                                                                                                                   │
│ 214 + ### Story 2.1: Smart Search Bar State Machine                                                                                                                                                                                                                                     │
│ 215 +                                                                                                                                                                                                                                                                                   │
│ 216 + As a Seeker (Hương),                                                                                                                                                                                                                                                              │
│ 217 + I want a search bar that understands different types of inputs,                                                                                                                                                                                                                   │
│ 218 + So that I can navigate quickly without using complex filters.                                                                                                                                                                                                                     │
│ 219 +                                                                                                                                                                                                                                                                                   │
│ 220 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 221 +                                                                                                                                                                                                                                                                                   │
│ 222 + **Given** I focus on the search bar                                                                                                                                                                                                                                               │
│ 223 + **When** I type a GeoID regex (e.g., "29CG.W8"), a keyword, or a price shorthand (e.g., "3tr")                                                                                                                                                                                    │
│ 224 + **Then** the Zustand state manager updates the search mode (Jump vs. Filter vs. Keyword)                                                                                                                                                                                          │
│ 225 + **And** the UI provides visual feedback for the detected mode                                                                                                                                                                                                                     │
│ 226 +                                                                                                                                                                                                                                                                                   │
│ 227 + ### Story 2.2: Guided Query Chips                                                                                                                                                                                                                                                 │
│ 228 +                                                                                                                                                                                                                                                                                   │
│ 229 + As a Seeker (Hương),                                                                                                                                                                                                                                                              │
│ 230 + I want the search bar to suggest filter chips as I type,                                                                                                                                                                                                                          │
│ 231 + So that I can build structured queries with minimal typing.                                                                                                                                                                                                                       │
│ 232 +                                                                                                                                                                                                                                                                                   │
│ 233 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 234 +                                                                                                                                                                                                                                                                                   │
│ 235 + **Given** I type an ambiguous term (e.g., "3") in the search bar                                                                                                                                                                                                                  │
│ 236 + **When** the suggestion dropdown appears                                                                                                                                                                                                                                          │
│ 237 + **Then** I see structured chips like "[Price < 3m]" or "[Floor: 3]"                                                                                                                                                                                                               │
│ 238 + **And** tapping a chip adds it to the active filter set and updates the listing grid                                                                                                                                                                                              │
│ 239 +                                                                                                                                                                                                                                                                                   │
│ 240 + ### Story 2.3: GeoID "Teleport" Navigation                                                                                                                                                                                                                                        │
│ 241 +                                                                                                                                                                                                                                                                                   │
│ 242 + As a Seeker (Hương),                                                                                                                                                                                                                                                              │
│ 243 + I want to jump directly to a property page when I enter its ID,                                                                                                                                                                                                                   │
│ 244 + So that I can skip the search results list entirely.                                                                                                                                                                                                                              │
│ 245 +                                                                                                                                                                                                                                                                                   │
│ 246 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 247 +                                                                                                                                                                                                                                                                                   │
│ 248 + **Given** I enter a complete GeoID (e.g., "29CG.W8K01")                                                                                                                                                                                                                           │
│ 249 + **When** the system matches the regex                                                                                                                                                                                                                                             │
│ 250 + **Then** the right-action button in the search bar pulses                                                                                                                                                                                                                         │
│ 251 + **And** tapping it (or Enter) triggers an instant < 300ms transition to the detail page                                                                                                                                                                                           │
│ 252 +                                                                                                                                                                                                                                                                                   │
│ 253 + ### Story 2.4: Secure Contact & Login Wall                                                                                                                                                                                                                                        │
│ 254 +                                                                                                                                                                                                                                                                                   │
│ 255 + As an Admin (Minh),                                                                                                                                                                                                                                                               │
│ 256 + I want to protect sensitive owner data behind a verification wall,                                                                                                                                                                                                                │
│ 257 + So that I can prevent bots from bulk-scraping contact information.                                                                                                                                                                                                                │
│ 258 +                                                                                                                                                                                                                                                                                   │
│ 259 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 260 +                                                                                                                                                                                                                                                                                   │
│ 261 + **Given** I am on a property detail page                                                                                                                                                                                                                                          │
│ 262 + **When** I attempt to view the contact information                                                                                                                                                                                                                                │
│ 263 + **Then** I am presented with a "Login Wall" (Supabase Auth) or verification gate                                                                                                                                                                                                  │
│ 264 + **And** access is granted only after successful authentication                                                                                                                                                                                                                    │
│ 265 +                                                                                                                                                                                                                                                                                   │
│ 266 + ### Story 2.5: Zalo Integration & Rate Limiting                                                                                                                                                                                                                                   │
│ 267 +                                                                                                                                                                                                                                                                                   │
│ 268 + As a Seeker (Hương),                                                                                                                                                                                                                                                              │
│ 269 + I want to contact the admin via Zalo with property context,                                                                                                                                                                                                                       │
│ 270 + So that I can inquire about a specific room efficiently.                                                                                                                                                                                                                          │
│ 271 +                                                                                                                                                                                                                                                                                   │
│ 272 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 273 +                                                                                                                                                                                                                                                                                   │
│ 274 + **Given** I have passed the verification wall                                                                                                                                                                                                                                     │
│ 275 + **When** I click the "Contact via Zalo" button                                                                                                                                                                                                                                    │
│ 276 + **Then** a pre-filled Zalo message is generated (e.g., "Hello, is listing 29CG.W8K01 still available?")                                                                                                                                                                           │
│ 277 + **And** the system increments my daily contact view count                                                                                                                                                                                                                         │
│ 278 + **And** I am blocked after 5 views per day (NFR5)                                                                                                                                                                                                                                 │
│ 279 +                                                                                                                                                                                                                                                                                   │
│ 280 + ### Story 2.6: Map View of Listings                                                                                                                                                                                                                                               │
│ 281 +                                                                                                                                                                                                                                                                                   │
│ 282 + As a Seeker (Hương),                                                                                                                                                                                                                                                              │
│ 283 + I want to see properties on a map,                                                                                                                                                                                                                                                │
│ 284 + So that I can understand their location in relation to landmarks or my school.                                                                                                                                                                                                    │
│ 285 +                                                                                                                                                                                                                                                                                   │
│ 286 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 287 +                                                                                                                                                                                                                                                                                   │
│ 288 + **Given** I toggle to "Map View"                                                                                                                                                                                                                                                  │
│ 289 + **When** the map loads                                                                                                                                                                                                                                                            │
│ 290 + **Then** I see property pins or circles based on their coordinate accuracy                                                                                                                                                                                                        │
│ 291 + **And** tapping a pin shows a mini-card preview with a link to details                                                                                                                                                                                                            │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ Epic 2 stories have been added to the document. Now, we'll move on to Epic 3: Automated Data Refinery & Geocoding.

  Epic 3 Goal: Introduce the high-throughput automation layer and cloud-based geocoding services to scale listing acquisition.
  FRs covered: FR13, FR14, FR15, FR17, FR18, FR19, FR21, FR22, FR24.

  Proposed Story Breakdown for Epic 3:

   * Story 3.1: Stateless Facebook Scraper (FR13, FR24)
       * Build the Dockerized Playwright scraper that performs high-frequency shallow scrapes of Facebook Groups without account dependency.
   * Story 3.2: Gemini AI Transformation Engine (FR14, FR18)
       * Implement the FastAPI service that uses Gemini Flash to extract structured data and rewrite descriptions from raw post text.
   * Story 3.3: Automated Geo-Identity & Fingerprinting (FR15)
       * Implement the backend logic to hash addresses/phones and check for fingerprint collisions before committing to the refinery queue.
   * Story 3.4: Geocoding Fallback Service (FR17)
       * Implement the geocoding sequence (Google Maps -> Nominatim fallback) to ensure coordinates are captured for every refinery item.
   * Story 3.5: Side-by-Side QC Cockpit (FR19, FR21, FR22)
       * Create the Admin dashboard for high-throughput review, comparing raw social posts vs. AI-refined data with one-click approval.
   * Story 3.6: Bot Defense & Honeypots (FR24)
       * Implement invisible honeypot links and rate-limiting to identify and auto-ban non-human agents.

  Does this breakdown for Epic 3 look correct?

> yes

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  Edit _bmad-output/.../epics.md: tapping a pin shows a mini-car... => tapping a pin shows a mini-car...                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                         │
│ 289   **When** the map loads                                                                                                                                                                                                                                                            │
│ 290   **Then** I see property pins or circles based on their coordinate accuracy                                                                                                                                                                                                        │
│ 291   **And** tapping a pin shows a mini-card preview with a link to details                                                                                                                                                                                                            │
│ 292 +                                                                                                                                                                                                                                                                                   │
│ 293 + ## Epic 3: Automated Data Refinery & Geocoding                                                                                                                                                                                                                                    │
│ 294 +                                                                                                                                                                                                                                                                                   │
│ 295 + Introduce the high-throughput automation layer and cloud-based geocoding services to scale listing acquisition.                                                                                                                                                                   │
│ 296 +                                                                                                                                                                                                                                                                                   │
│ 297 + ### Story 3.1: Stateless Facebook Scraper                                                                                                                                                                                                                                         │
│ 298 +                                                                                                                                                                                                                                                                                   │
│ 299 + As an Admin (Minh),                                                                                                                                                                                                                                                               │
│ 300 + I want an automated scraper to capture rental leads from social media,                                                                                                                                                                                                            │
│ 301 + So that I don't have to manually browse Facebook groups for data.                                                                                                                                                                                                                 │
│ 302 +                                                                                                                                                                                                                                                                                   │
│ 303 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 304 +                                                                                                                                                                                                                                                                                   │
│ 305 + **Given** the scraper is deployed in a Docker container                                                                                                                                                                                                                           │
│ 306 + **When** the scheduler triggers a shallow-scrape of targeted Facebook Groups                                                                                                                                                                                                      │
│ 307 + **Then** Playwright captures raw post text and images without requiring a logged-in account                                                                                                                                                                                       │
│ 308 + **And** the raw data is sent to the `/api/v1/ingest` endpoint with the correct shared secret                                                                                                                                                                                      │
│ 309 +                                                                                                                                                                                                                                                                                   │
│ 310 + ### Story 3.2: Gemini AI Transformation Engine                                                                                                                                                                                                                                    │
│ 311 +                                                                                                                                                                                                                                                                                   │
│ 312 + As an Admin (Minh),                                                                                                                                                                                                                                                               │
│ 313 + I want the system to automatically structure and rewrite raw social media posts,                                                                                                                                                                                                  │
│ 314 + So that I have clean, searchable data and unique content that prevents "search-back" to the original post.                                                                                                                                                                        │
│ 315 +                                                                                                                                                                                                                                                                                   │
│ 316 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 317 +                                                                                                                                                                                                                                                                                   │
│ 318 + **Given** raw post data has been ingested                                                                                                                                                                                                                                         │
│ 319 + **When** the Gemini Flash transformation engine processes the text                                                                                                                                                                                                                │
│ 320 + **Then** it extracts structured attributes (Price, Ward, District, Amenities) into a Pydantic-validated JSON                                                                                                                                                                      │
│ 321 + **And** it generates a unique, rewritten description that maintains the original facts but uses different phrasing                                                                                                                                                                │
│ 322 +                                                                                                                                                                                                                                                                                   │
│ 323 + ### Story 3.3: Automated Geo-Identity & Fingerprinting                                                                                                                                                                                                                            │
│ 324 +                                                                                                                                                                                                                                                                                   │
│ 325 + As a System,                                                                                                                                                                                                                                                                      │
│ 326 + I want to identify if a social media post refers to a property already in our database,                                                                                                                                                                                           │
│ 327 + So that I can maintain a single source of truth for physical properties.                                                                                                                                                                                                          │
│ 328 +                                                                                                                                                                                                                                                                                   │
│ 329 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 330 +                                                                                                                                                                                                                                                                                   │
│ 331 + **Given** structured data from the AI engine                                                                                                                                                                                                                                      │
│ 332 + **When** the system hashes the address and owner phone number                                                                                                                                                                                                                     │
│ 333 + **Then** it checks for existing "fingerprint" collisions in Supabase                                                                                                                                                                                                              │
│ 334 + **And** it flags the refinery item as "Duplicate" or "Update" if a match is found, preserving the Geo-Identity                                                                                                                                                                    │
│ 335 +                                                                                                                                                                                                                                                                                   │
│ 336 + ### Story 3.4: Geocoding Fallback Service                                                                                                                                                                                                                                         │
│ 337 +                                                                                                                                                                                                                                                                                   │
│ 338 + As a System,                                                                                                                                                                                                                                                                      │
│ 339 + I want to automatically map property addresses to geographic coordinates,                                                                                                                                                                                                         │
│ 340 + So that I can display them accurately on the seeker's map.                                                                                                                                                                                                                        │
│ 341 +                                                                                                                                                                                                                                                                                   │
│ 342 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 343 +                                                                                                                                                                                                                                                                                   │
│ 344 + **Given** a structured address                                                                                                                                                                                                                                                    │
│ 345 + **When** the geocoding service is triggered                                                                                                                                                                                                                                       │
│ 346 + **Then** it attempts to resolve coordinates via the Google Maps API                                                                                                                                                                                                               │
│ 347 + **And** if Google fails, it automatically falls back to OSM Nominatim                                                                                                                                                                                                             │
│ 348 + **And** the final coordinates are saved with the listing                                                                                                                                                                                                                          │
│ 349 +                                                                                                                                                                                                                                                                                   │
│ 350 + ### Story 3.5: Side-by-Side QC Cockpit                                                                                                                                                                                                                                            │
│ 351 +                                                                                                                                                                                                                                                                                   │
│ 352 + As an Admin (Minh),                                                                                                                                                                                                                                                               │
│ 353 + I want a high-throughput interface to verify AI-processed data,                                                                                                                                                                                                                   │
│ 354 + So that I can maintain 100% data accuracy with minimal effort.                                                                                                                                                                                                                    │
│ 355 +                                                                                                                                                                                                                                                                                   │
│ 356 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 357 +                                                                                                                                                                                                                                                                                   │
│ 358 + **Given** items are pending in the refinery queue                                                                                                                                                                                                                                 │
│ 359 + **When** I open the QC Cockpit                                                                                                                                                                                                                                                    │
│ 360 + **Then** I see a side-by-side comparison of the raw Facebook post and the AI-refined data                                                                                                                                                                                         │
│ 361 + **And** I can edit any field and approve or reject the listing with a single click (or hotkey)                                                                                                                                                                                    │
│ 362 + **And** approval instantly publishes the listing to the public feed                                                                                                                                                                                                               │
│ 363 +                                                                                                                                                                                                                                                                                   │
│ 364 + ### Story 3.6: Bot Defense & Honeypots                                                                                                                                                                                                                                            │
│ 365 +                                                                                                                                                                                                                                                                                   │
│ 366 + As an Admin (Minh),                                                                                                                                                                                                                                                               │
│ 367 + I want to protect my refined data from being stolen by competitor scrapers,                                                                                                                                                                                                       │
│ 368 + So that I maintain my competitive advantage as the "Clean Source of Truth."                                                                                                                                                                                                       │
│ 369 +                                                                                                                                                                                                                                                                                   │
│ 370 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 371 +                                                                                                                                                                                                                                                                                   │
│ 372 + **Given** a non-human agent attempts to scrape the site                                                                                                                                                                                                                           │
│ 373 + **When** it triggers an invisible "Honeypot" link                                                                                                                                                                                                                                 │
│ 374 + **Then** the system identifies the IP and automatically blacklists it within < 10 seconds                                                                                                                                                                                         │
│ 375 + **And** the agent can no longer access sensitive contact or listing data                                                                                                                                                                                                          │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ Epic 3 stories have been added. Now, we'll finish with Epic 4: The Time Machine (Transparency & History).

  Epic 4 Goal: Implement SCD Type 2 tracking to visualize historical price trends for properties.
  FRs covered: FR7.

  Proposed Story Breakdown for Epic 4:

   * Story 4.1: Historical Price Tracking (FR7)
       * Implement the backend logic to automatically snapshot price changes into the listing_history table whenever a listing is updated.
   * Story 4.2: Price Timeline Visualization (FR7)
       * Create a chart/timeline component on the property detail page showing the price evolution over time.

  Does this breakdown for Epic 4 look correct?

> yes

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ x  Edit {"file_path":"/Users/mac/nhaminhbach.com/nhaminhbach/_bmad-output/planning-artifacts/epics.md","expected_replacements":1,"old_string":"---\nstepsCompleted: [1, 2]\ninputDocuments:\n  - _bmad-output/planning-artifacts/prd.md\n  - _bmad-output/planning-artifacts/architect… │
│                                                                                                                                                                                                                                                                                         │
│ ...geocoding service is triggered                                                                                                                                                                                                                                                       │
│ **Then** it attempts to resolve coordinates via the Google Maps API                                                                                                                                                                                                                     │
│ **And** if Google fails, it automatically falls back to OSM Nominatim                                                                                                                                                                                                                   │
│ **And** the final coordinates are saved with the listing                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                         │
│ ### Story 3.5: Side-by-Side QC Cockpit                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                         │
│ As an Admin (Minh),                                                                                                                                                                                                                                                                     │
│ I want a high-throughput interface to verify AI-processed data,                                                                                                                                                                                                                         │
│ So that I can maintain 100% data accuracy with minimal effort.                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                         │
│ **Acceptance Criteria:**                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                         │
│ **Given** items are pending in the refinery queue                                                                                                                                                                                                                                       │
│ **When** I open the QC Cockpit                                                                                                                                                                                                                                                          │
│ **Then** I see a side-by-side comparison of the raw Facebook post and the AI-refined data                                                                                                                                                                                               │
│ **And** I can edit any field and approve or reject the listing with a single click (or hotkey)                                                                                                                                                                                          │
│ **And** approval instantly publishes the listing to the public feed                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ ### Story 3.6: Bot Defense & Honeypots                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                         │
│ As an Admin (Minh),                                                                                                                                                                                                                                                                     │
│ I want to protect my refined data from being stolen by competitor scrapers,                                                                                                                                                                                                             │
│ So that I maintain my competitive advantage as the "Clean Source of Truth."                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                         │
│ **Acceptance Criteria:**                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                         │
│ **Given** a non-human agent attempts to scrape the site                                                                                                                                                                                                                                 │
│ **When** it triggers an invisible "Honeypot" link                                                                                                                                                                                                                                       │
│ **Then** the system identifies the IP and automatically blacklists it within < 10 seconds                                                                                                                                                                                               │
│ **And** the agent can no longer access sensitive contact or listing data                                                                                                                                                                                                                │
│ ). Original old_string was (---                                                                                                                                                                                                                                                         │
│ stepsCompleted: [1, 2]                                                                                                                                                                                                                                                                  │
│ inputDocuments:                                                                                                                                                                                                                                                                         │
│   - _bmad-output/planning-artifacts/prd.md                                                                                                                                                                                                                                              │
│   - _bmad-output/planning-artifacts/architecture.md                                                                                                                                                                                                                                     │
│   - _bmad-output/planning-artifacts/ux-design-specification.md                                                                                                                                                                                                                          │
│ ---                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ # nhaminhbach - Epic Breakdown                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                         │
│ ## Overview                                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                         │
│ This document provides the complete epic and story breakdown for nhaminhbach, decomposing the requirements from the PRD, UX Design if it exists, and Architecture requirements into implementable stories.                                                                              │
│                                                                                                                                                                                                                                                                                         │
│ ## Requirements Inventory                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                         │
│ ### Functional Requirements                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                         │
│ FR1: Seekers can navigate directly to a specific property using a unique GeoID.                                                                                                                                                                                                         │
│ FR2: Seekers can build logical queries using a guided token-based interface (chips).                                                                                                                                                                                                    │
│ FR3: Seekers can perform standard keyword searches across property descriptions.                                                                                                                                                                                                        │
│ FR4: Seekers can filter property results by Price Range, Ward, and District.                                                                                                                                                                                                            │
│ FR5: Seekers can view a map representation of property locations (pin or circle based on accuracy).                                                                                                                                                                                     │
│ FR6: Seekers can toggle between a "Guided Query" mode and standard keyword search.                                                                                                                                                                                                      │
│ FR7: Seekers can view a historical price timeline for a specific room (The "Time Machine").                                                                                                                                                                                             │
│ FR8: Seekers can view "Góc nhìn thật" (Real view) and "Điểm trừ" (Cons) metadata for any listing.                                                                                                                                                                                       │
│ FR9: Seekers can initiate a direct Zalo chat with the Platform Admin (Minh) regarding a specific property.                                                                                                                                                                              │
│ FR10: Landlords can share their specific property or portfolio via a human-readable alias URL.                                                                                                                                                                                          │
│ FR11: Users can view property contact information only after passing a "Login Wall" or verification gate.                                                                                                                                                                               │
│ FR12: Users can trigger a pre-filled Zalo message template containing the property's GeoID.                                                                                                                                                                                             │
│ FR13: The System can autonomously ingest raw rental posts from social media sources.                                                                                                                                                                                                    │
│ FR14: The System can transform unstructured Vietnamese text into structured property data.                                                                                                                                                                                              │
│ FR15: The System can identify unique physical properties across multiple social posts using address/phone fingerprinting.                                                                                                                                                               │
│ FR16: The System can automatically generate unique, hierarchical GeoIDs for new properties.                                                                                                                                                                                             │
│ FR17: Epic 3 - System geocodes addresses with fallback logic.                                                                                                                                                                                                                           │
│ FR18: The System can rewrite social media descriptions into unique platform content using AI.                                                                                                                                                                                           │
│ FR19: Admins can review ingested data in a side-by-side comparison interface (Raw vs. Refined).                                                                                                                                                                                         │
│ FR20: Admins can manually override and edit any attribute of a listing before approval.                                                                                                                                                                                                 │
│ FR21: Admins can approve or reject pending listings with a single action.                                                                                                                                                                                                               │
│ FR22: Admins can view fingerprint collision alerts for properties that have appeared historically.                                                                                                                                                                                      │
│ FR23: Admins can manage the "Available/Rented" status of any room in the system.                                                                                                                                                                                                        │
│ FR24: The System can identify and auto-ban non-human scraping agents via invisible "Honeypot" links.                                                                                                                                                                                    │
│ FR25: The System can rate-limit the viewing of sensitive contact information per user.                                                                                                                                                                                                  │
│ FR26: The System can enforce a "Login Wall" for accessing owner/admin contact details.                                                                                                                                                                                                  │
│ FR27: Admins can manually input new listings (individually or in bulk) via the admin interface, reusing the manual edit components.                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ ### NonFunctional Requirements                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                         │
│ NFR1: Short ID Resolution: Entering a GeoID in the search bar must resolve to the property page in < 300ms (network excluding).                                                                                                                                                         │
│ NFR2: Search Intent Latency: Transforming natural language to a logical query and returning results must complete in < 800ms.                                                                                                                                                           │
│ NFR3: First Contentful Paint (FCP): The public landing page must load in < 1.5s on a standard 4G connection in Hanoi.                                                                                                                                                                   │
│ NFR4: Mobile Smoothness: Touch interactions (scrolling, chip selection) must maintain 60fps to ensure a "Zalo-like" responsive feel.                                                                                                                                                    │
│ NFR5: Data Protection (Smart Gating): Owner contact information must be protected behind a rate-limiting gate (e.g., maximum 5 contact views per day per user).                                                                                                                         │
│ NFR6: Competitor Defense: Implement Honeypot link detection that automatically blacklists IPs demonstrating bulk-scraping behavior within < 10 seconds of detection.                                                                                                                    │
│ NFR7: Data Integrity: All LLM-generated data must pass Pydantic schema validation before being committed to Supabase to prevent data corruption.                                                                                                                                        │
│ NFR8: Admin Security: Minh's access to the QC Cockpit must be secured via Multi-Factor Authentication (MFA) or Zalo Social Login.                                                                                                                                                       │
│ NFR9: Horizontal Scraping: The GCP pipeline must support scaling to 50+ concurrent Cloud Run instances to handle regional expansion without architectural changes.                                                                                                                      │
│ NFR10: Storage Strategy: Supabase storage must handle up to 100,000 active listings with price history without query performance degradation (using proper indexing on full_geo_id and address_hash).                                                                                   │
│ NFR11: Refinery Throughput: The transformation engine must be capable of processing 1,000+ social media posts daily without human intervention bottlenecking the pipeline.                                                                                                              │
│ NFR12: SLA Freshness: Data ingested from social media must be processed and ready for verification in < 24 hours.                                                                                                                                                                       │
│ NFR13: Transactional Consistency: 100% of listing creations must be Atomic (House + Room + History) to prevent partial data states.                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ ### Additional Requirements                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                         │
│ **From Architecture:**                                                                                                                                                                                                                                                                  │
│ - **Starter Template:** Use the Custom Turborepo Construction with pnpm workspaces for React (Vite), FastAPI, and Docker (Scraper).                                                                                                                                                     │
│ - **Data Modeling:** Use JSONB for property attributes in PostgreSQL, validated by Pydantic v2.                                                                                                                                                                                         │
│ - **Migrations:** Use Alembic (v1.18.2) for schema evolution.                                                                                                                                                                                                                           │
│ - **Identity & Auth:** Use Supabase Auth for user-facing services and Shared API Secret (X-NHB-SECRET) for Scraper-to-API communication.                                                                                                                                                │
│ - **Frontend State:** Use TanStack Query (v5.x) for server state and Zustand (v5.x) for client state (Search Bar).                                                                                                                                                                      │
│ - **Deployment:** Docker-First for Scraper, Vercel for App Tier.                                                                                                                                                                                                                        │
│ - **Naming Conventions:** Strict adherence to defined naming (camelCase JSON, snake_case DB/Python) and structure patterns.                                                                                                                                                             │
│ - **Error Handling:** Standardized Error Objects for API responses.                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ **From UX Design:**                                                                                                                                                                                                                                                                     │
│ - **Responsive Design:** Mobile-First SPA optimized for 360px-420px viewports.                                                                                                                                                                                                          │
│ - **Interaction:** "Smart Waterfall Search Bar" logic (GeoID -> Chips -> Keyword).                                                                                                                                                                                                      │
│ - **Touch Targets:** Minimum 44px hit area for all interactive elements.                                                                                                                                                                                                                │
│ - **Aesthetic:** "Future Warmth" palette (Coral/Cream) and "Her" aesthetic (soft rounded corners).                                                                                                                                                                                      │
│ - **Component Strategy:** Use Headless UI wrapped in Tailwind CSS.                                                                                                                                                                                                                      │
│ - **Navigation:** Bottom Sheets for detail views on mobile; Gestures for closing.                                                                                                                                                                                                       │
│ - **Accessibility:** Keyboard sovereignty for Search Bar; WCAG 2.1 AA contrast compliance.                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                         │
│ ### FR Coverage Map                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ FR1: Epic 2 - Seekers can navigate directly via GeoID.                                                                                                                                                                                                                                  │
│ FR2: Epic 2 - Seekers can build queries with chips.                                                                                                                                                                                                                                     │
│ FR3: Epic 1 - Seekers can perform keyword searches.                                                                                                                                                                                                                                     │
│ FR4: Epic 1 - Seekers can filter by Price, Ward, District.                                                                                                                                                                                                                              │
│ FR5: Epic 2 - Seekers can view property map.                                                                                                                                                                                                                                            │
│ FR6: Epic 2 - Seekers can toggle search modes.                                                                                                                                                                                                                                          │
│ FR7: Epic 4 - Seekers can view historical price timeline.                                                                                                                                                                                                                               │
│ FR8: Epic 1 - Seekers can view 'Real View' and 'Cons'.                                                                                                                                                                                                                                  │
│ FR9: Epic 2 - Seekers can initiate Zalo chat with Admin.                                                                                                                                                                                                                                │
│ FR10: Epic 1 - Landlords can share via human-readable URLs.                                                                                                                                                                                                                             │
│ FR11: Epic 2 - Users must pass a Login Wall for contact info.                                                                                                                                                                                                                           │
│ FR12: Epic 2 - Users can trigger pre-filled Zalo messages with GeoID.                                                                                                                                                                                                                   │
│ FR13: Epic 3 - System autonomously ingests social posts.                                                                                                                                                                                                                                │
│ FR14: Epic 3 - System transforms unstructured text to structured data.                                                                                                                                                                                                                  │
│ FR15: Epic 3 - System identifies unique properties via fingerprinting.                                                                                                                                                                                                                  │
│ FR16: Epic 1 - System generates unique, hierarchical GeoIDs.                                                                                                                                                                                                                            │
│ FR17: Epic 3 - System geocodes addresses with fallback logic.                                                                                                                                                                                                                           │
│ FR18: Epic 3 - System rewrites descriptions using AI.                                                                                                                                                                                                                                   │
│ FR19: Epic 3 - Admins can review data side-by-side.                                                                                                                                                                                                                                     │
│ FR20: Epic 1 - Admins can manually override and edit attributes.                                                                                                                                                                                                                        │
│ FR21: Epic 3 - Admins can approve or reject pending listings.                                                                                                                                                                                                                           │
│ FR22: Epic 3 - Admins can view fingerprint collision alerts.                                                                                                                                                                                                                            │
│ FR23: Epic 1 - Admins can manage available/rented status.                                                                                                                                                                                                                               │
│ FR24: Epic 3 - System can auto-ban non-human scrapers via Honeypots.                                                                                                                                                                                                                    │
│ FR25: Epic 2 - System rate-limits contact information views.                                                                                                                                                                                                                            │
│ FR26: Epic 2 - System enforces login wall for owner details.                                                                                                                                                                                                                            │
│ FR27: Epic 1 - Admins can manually input listings (individually or in bulk).                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                         │
│ ## Epic List                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                         │
│ ### Epic 1: The Manual MVP (Core Listing & Viewing)                                                                                                                                                                                                                                     │
│ Build the essential manual platform where Admins can create listings by hand and Seekers can discover and view them. Validates the core data model and user experience.                                                                                                                 │
│ **FRs covered:** FR3, FR4, FR8, FR10, FR16, FR20, FR23, FR27.                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                         │
│ ### Epic 2: The "Smart" Search & Interaction                                                                                                                                                                                                                                            │
│ Enhance the seeker experience with the innovative "Smart Waterfall Search" (GeoID jumps, Guided Chips) and secure contact flows.                                                                                                                                                        │
│ **FRs covered:** FR1, FR2, FR5, FR6, FR9, FR11, FR12, FR25, FR26.                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
│ ### Epic 3: Automated Data Refinery & Geocoding                                                                                                                                                                                                                                         │
│ Introduce the high-throughput automation layer and cloud-based geocoding services to scale listing acquisition.                                                                                                                                                                         │
│ **FRs covered:** FR13, FR14, FR15, FR17, FR18, FR19, FR21, FR22, FR24.                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                         │
│ ### Epic 4: The Time Machine (Transparency & History)                                                                                                                                                                                                                                   │
│ Implement SCD Type 2 tracking to visualize historical price trends for properties.                                                                                                                                                                                                      │
│ **FRs covered:** FR7.                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                         │
│ ## Epic 1: The Manual MVP (Core Listing & Viewing)                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                         │
│ Build the essential manual platform where Admins can create listings by hand and Seekers can discover and view them. Validates the core data model and user experience.                                                                                                                 │
│                                                                                                                                                                                                                                                                                         │
│ ### Story 1.1: Project Scaffolding & Database Foundation                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                         │
│ As a Developer,                                                                                                                                                                                                                                                                         │
│ I want to set up the monorepo and core database schema,                                                                                                                                                                                                                                 │
│ So that I have a solid foundation for implementing features.                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                         │
│ **Acceptance Criteria:**                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                         │
│ **Given** a clean project directory                                                                                                                                                                                                                                                     │
│ **When** I run the initialization commands                                                                                                                                                                                                                                              │
│ **Then** a Turborepo monorepo is created with apps/web (Vite/React), apps/api (FastAPI), and packages/scraper                                                                                                                                                                           │
│ **And** pnpm and uv are configured for dependency management                                                                                                                                                                                                                            │
│ **And** the project directory structure matches the architectural design document                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
│ **Given** a Supabase project                                                                                                                                                                                                                                                            │
│ **When** I apply the initial Alembic migrations                                                                                                                                                                                                                                         │
│ **Then** the houses and rooms tables are created with support for JSONB attributes                                                                                                                                                                                                      │
│ **And** the schema supports SCD Type 2 history (tracking changes via valid_from/valid_to)                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                         │
│ ### Story 1.2: Admin Manual Listing Creation                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                         │
│ As an Admin (Minh),                                                                                                                                                                                                                                                                     │
│ I want to manually input a new property listing,                                                                                                                                                                                                                                        │
│ So that I can start building the platform's data without automation.                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                         │
│ **Acceptance Criteria:**                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                         │
│ **Given** I am logged into the Admin interface                                                                                                                                                                                                                                          │
│ **When** I enter a property address and details (Price, Ward, District, Specs) and submit                                                                                                                                                                                               │
│ **Then** the system checks for address fingerprint collisions                                                                                                                                                                                                                           │
│ **And** generates a unique hierarchical GeoID (e.g., 29CG.W8K01)                                                                                                                                                                                                                        │
│ **And** creates a new House and Room record in the database                                                                                                                                                                                                                             │
│ **And** the new listing is saved with status "Available"                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                         │
│ ### Story 1.3: Seeker Discovery Grid & Keyword Search                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                         │
│ As a Seeker (Hương),                                                                                                                                                                                                                                                                    │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  Edit _bmad-output/.../epics.md: **And** the agent can no longe... => **And** the agent can no longe...                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                         │
│ 373   **When** it triggers an invisible "Honeypot" link                                                                                                                                                                                                                                 │
│ 374   **Then** the system identifies the IP and automatically blacklists it within < 10 seconds                                                                                                                                                                                         │
│ 375   **And** the agent can no longer access sensitive contact or listing data                                                                                                                                                                                                          │
│ 376 +                                                                                                                                                                                                                                                                                   │
│ 377 + ## Epic 4: The Time Machine (Transparency & History)                                                                                                                                                                                                                              │
│ 378 +                                                                                                                                                                                                                                                                                   │
│ 379 + Implement SCD Type 2 tracking to visualize historical price trends for properties.                                                                                                                                                                                                │
│ 380 +                                                                                                                                                                                                                                                                                   │
│ 381 + ### Story 4.1: Historical Price Tracking                                                                                                                                                                                                                                          │
│ 382 +                                                                                                                                                                                                                                                                                   │
│ 383 + As a System,                                                                                                                                                                                                                                                                      │
│ 384 + I want to automatically snapshot price changes,                                                                                                                                                                                                                                   │
│ 385 + So that I can preserve a historical record of property valuation.                                                                                                                                                                                                                 │
│ 386 +                                                                                                                                                                                                                                                                                   │
│ 387 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 388 +                                                                                                                                                                                                                                                                                   │
│ 389 + **Given** an existing listing is being updated with a new price                                                                                                                                                                                                                   │
│ 390 + **When** the update is committed                                                                                                                                                                                                                                                  │
│ 391 + **Then** the current record is versioned (valid_to is set)                                                                                                                                                                                                                        │
│ 392 + **And** a new record with the updated price is created (valid_from is set)                                                                                                                                                                                                        │
│ 393 + **And** the entire change is wrapped in a single database transaction                                                                                                                                                                                                             │
│ 394 +                                                                                                                                                                                                                                                                                   │
│ 395 + ### Story 4.2: Price Timeline Visualization                                                                                                                                                                                                                                       │
│ 396 +                                                                                                                                                                                                                                                                                   │
│ 397 + As a Seeker (Hương),                                                                                                                                                                                                                                                              │
│ 398 + I want to see a history of price changes for a property,                                                                                                                                                                                                                          │
│ 399 + So that I can understand its market trend and build trust in the listing.                                                                                                                                                                                                         │
│ 400 +                                                                                                                                                                                                                                                                                   │
│ 401 + **Acceptance Criteria:**                                                                                                                                                                                                                                                          │
│ 402 +                                                                                                                                                                                                                                                                                   │
│ 403 + **Given** I am on a property detail page                                                                                                                                                                                                                                          │
│ 404 + **When** I scroll to the "Price History" section                                                                                                                                                                                                                                  │
│ 405 + **Then** I see a visual timeline or chart showing historical price points                                                                                                                                                                                                         │
│ 406 + **And** the data is fetched accurately from the SCD Type 2 history records                                                                                                                                                                                                        │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  Edit _bmad-output/.../epics.md: ---... => ---...                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ 1   ---                                                                                                                                                                                                                                                                                 │
│ 2 - stepsCompleted: [1, 2]                                                                                                                                                                                                                                                              │
│ 2 + stepsCompleted: [1, 2, 3]                                                                                                                                                                                                                                                           │
│ 3   inputDocuments:                                                                                                                                                                                                                                                                     │
│ 4     - _bmad-output/planning-artifacts/prd.md                                                                                                                                                                                                                                          │
│ 5     - _bmad-output/planning-artifacts/architecture.md                                                                                                                                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ All epics and stories have been generated and saved to _bmad-output/planning-artifacts/epics.md following the template structure.

  Epic Breakdown Summary:
   - Epic 1: The Manual MVP (5 stories)
   - Epic 2: The "Smart" Search & Interaction (6 stories)
   - Epic 3: Automated Data Refinery & Geocoding (6 stories)
   - Epic 4: The Time Machine (Transparency & History) (2 stories)

  Select an Option to proceed to Final Validation:
   - [C] Continue
   - [A] Advanced Elicitation
   - [P] Party Mode

> continue

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  ReadFile _bm/.../step-04-final-validation.md                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ We have reached the final validation step to ensure all requirements are covered and stories are implementation-ready.

  1. Functional Requirements Coverage Validation
  I have cross-referenced the 27 Functional Requirements (FR1 - FR27) with the generated stories:
   - Epic 1 (Manual MVP): Covers FR3, FR4, FR8, FR10, FR16, FR20, FR23, FR27.
   - Epic 2 (Smart Search): Covers FR1, FR2, FR5, FR6, FR9, FR11, FR12, FR25, FR26.
   - Epic 3 (Refinery/Automation): Covers FR13, FR14, FR15, FR17, FR18, FR19, FR21, FR22, FR24.
   - Epic 4 (History): Covers FR7.

  Result: 100% coverage confirmed.

  2. Architecture & Dependency Validation
   - Starter Template: Story 1.1 explicitly includes monorepo scaffolding and directory structure setup as per the Architecture ADD.
   - JIT Database Creation: Stories create/modify only the tables they need (e.g., Story 1.1 for base House/Room, Story 4.1 for History tables).
   - No Forward Dependencies: Each story is designed to be independently completable by a single agent, building only on previously completed stories.

  3. Epic Independence
   - Epic 1 delivers a manual but fully functional listing platform.
   - Epic 2 improves the search/interaction layer on top of Epic 1.
   - Epic 3 introduces backend automation that replaces the manual workflows from Epic 1.
   - Epic 4 adds an optional transparency layer.

  Final Check:
   - All placeholders in _bmad-output/planning-artifacts/epics.md have been replaced.
   - Formatting is consistent with the template.

  All validations complete!

  Select an Option:
   - [C] Complete Workflow
   - [Chat] or ask questions

> C

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓  Edit _bmad-output/.../epics.md: ---... => ---...                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                         │
│ 1   ---                                                                                                                                                                                                                                                                                 │
│ 2 - stepsCompleted: [1, 2, 3]                                                                                                                                                                                                                                                           │
│ 2 + stepsCompleted: [1, 2, 3, 4]                                                                                                                                                                                                                                                        │
│ 3   inputDocuments:                                                                                                                                                                                                                                                                     │
│ 4     - _bmad-output/planning-artifacts/prd.md                                                                                                                                                                                                                                          │
│ 5     - _bmad-output/planning-artifacts/architecture.md                                                                                                                                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ The Create Epics and Stories workflow is now complete.

  The comprehensive breakdown is available at _bmad-output/planning-artifacts/epics.md. This document is now ready for development, with all 27 functional requirements mapped to implementation-ready user stories across four value-driven epics.

> /quit

╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                                                                                                                                                                         │
│  Agent powering down. Goodbye!                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                         │
│  Interaction Summary                                                                                                                                                                                                                                                                    │
│  Session ID:                 a294c574-5519-41c1-9e41-f46a1606bdfb                                                                                                                                                                                                                       │
│  Tool Calls:                 35 ( ✓ 32 x 3 )                                                                                                                                                                                                                                            │
│  Success Rate:               91.4%                                                                                                                                                                                                                                                      │
│  User Agreement:             100.0% (35 reviewed)                                                                                                                                                                                                                                       │
│  Code Changes:               +535 -127                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                         │
│  Performance                                                                                                                                                                                                                                                                            │
│  Wall Time:                  45m 26s                                                                                                                                                                                                                                                    │
│  Agent Active:               32m 20s                                                                                                                                                                                                                                                    │
│    » API Time:               13m 36s (42.1%)                                                                                                                                                                                                                                            │
│    » Tool Time:              18m 44s (57.9%)                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                         │
│  Model Usage                 Reqs   Input Tokens   Cache Reads  Output Tokens                                                                                                                                                                                                           │
│  ────────────────────────────────────────────────────────────────────────────                                                                                                                                                                                                           │
│  gemini-2.5-flash-lite        360        187,330        58,168          4,246                                                                                                                                                                                                           │
│  gemini-3-flash-preview        32        335,232     1,120,248         19,910                                                                                                                                                                                                           │
│  gemini-3-pro-preview          12        162,935       290,270          4,849                                                                                                                                                                                                           │
│  gemini-2.5-flash               5          2,250             0             87                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                         │
│  Savings Highlight: 1,468,686 (68.1%) of input tokens were served from the cache, reducing costs.                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                         │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

mac@192 nhaminhbach % 